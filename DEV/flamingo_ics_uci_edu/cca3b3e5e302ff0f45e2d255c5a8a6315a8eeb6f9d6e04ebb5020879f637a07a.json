{"url": "http://flamingo.ics.uci.edu/releases/4.0/src/topk/src/topkindex.v1.cc", "content": "/*\n  $Id: topkindex.v1.cc 5776 2010-10-20 01:34:22Z abehm $\n\n  Copyright (C) 2007 by The Regents of the University of California\n \n  Redistribution of this file is permitted under the terms of the BSD\n  license\n\n  Date: 04/28/2008\n  Author: Rares Vernica <rares (at) ics.uci.edu>\n*/\n\n#include \"topkindex.v1.h\"\n#include \"util/src/io.h\"\n\nusing namespace std;\nusing namespace tr1;\n\nnamespace Topk \n{\n  Index_v1::~Index_v1() \n  {\n    for (unordered_map<uint, Array<uint>*>::const_iterator it = lists.begin();\n         it != lists.end(); ++it)\n      delete it->second;\n  }\n\n  void Index_v1::load(const string &filename) \n  {\n    std::ifstream file(filename.c_str(), std::ios::in | std::ios::binary);\n\n    if (!file) {\n      std::cerr << \"can't open input file \\\"\" << filename << \"\\\"\" << std::endl;\n      exit(EXIT_FAILURE);\n    }\n\n    READING_FILE(filename);\n    std::istream_iterator<binary_io<uint> > i(file);\n\n    lenMax = *i++;\n    noGramsMin = *i++;\n\n    while (i != std::istream_iterator<binary_io<uint> >()) {\n      uint gram = *i++;\n      uint size = *i++;\n\n      Array<uint> *lst = new Array<uint>(size); \n      for (uint j = 0; j < size; ++j) {\n        uint id = *i++;\n\n        lst->append(id);\n      }\n      lists.insert(make_pair(gram, lst));\n    }\n    READING_DONE();\n  }\n\n  void Index_v1::save(const string &filename) \n    const \n  {  \n    std::ofstream file(filename.c_str(), std::ios::out | std::ios::binary);\n\n    if (!file) {\n      std::cerr << \"can't open output file \\\"\" << filename << \"\\\"\" << std::endl;\n      exit(EXIT_FAILURE);\n    }\n\n    WRITING_FILE(filename);\n    std::ostream_iterator<binary_io<uint> > o(file);\n\n    *o++ = lenMax;\n    *o++ = noGramsMin;\n\n    for (unordered_map<uint, Array<uint>*>::const_iterator lst = lists.begin();\n         lst != lists.end(); ++lst) {\n      *o++ = lst->first;    \n      *o++ = lst->second->size();\n      for (uint i = 0; i < lst->second->size(); ++i)\n        *o++= lst->second->at(i);\n    }\n\n    file.close();\n    WRITING_DONE();\n  }\n}\n", "encoding": "ascii"}