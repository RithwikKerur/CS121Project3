{"url": "https://grape.ics.uci.edu/wiki/asterix/raw-attachment/wiki/cs122a-2018-spring/SQL%2B%2BPrimer.txt", "content": "\n\nDROP DATAVERSE TinySocial IF EXISTS;\nCREATE DATAVERSE TinySocial;\nUSE TinySocial;\n\nCREATE TYPE ChirpUserType AS {\n    screenName: string,\n    lang: string,\n    friendsCount: int,\n    statusesCount: int,\n    name: string,\n    followersCount: int\n};\n\nCREATE TYPE ChirpMessageType AS closed {\n    chirpId: string,\n    user: ChirpUserType,\n    senderLocation: point?,\n    sendTime: datetime,\n    referredTopics: {{ string }},\n    messageText: string\n};\n\nCREATE TYPE EmploymentType AS {\n    organizationName: string,\n    startDate: date,\n    endDate: date?\n};\n\nCREATE TYPE GleambookUserType AS {\n    id: int,\n    alias: string,\n    name: string,\n    userSince: datetime,\n    friendIds: {{ int }},\n    employment: [EmploymentType]\n};\n\nCREATE TYPE GleambookMessageType AS {\n    messageId: int,\n    authorId: int,\n    inResponseTo: int?,\n    senderLocation: point?,\n    message: string\n};\n\nCREATE DATASET GleambookUsers(GleambookUserType)\n    PRIMARY KEY id;\n\nCREATE DATASET GleambookMessages(GleambookMessageType)\n    PRIMARY KEY messageId;\n\nCREATE DATASET ChirpUsers(ChirpUserType)\n    PRIMARY KEY screenName;\n\nCREATE DATASET ChirpMessages(ChirpMessageType)\n    PRIMARY KEY chirpId\n    hints(cardinality=100);\n\nCREATE INDEX gbUserSinceIdx on GleambookUsers(userSince);\nCREATE INDEX gbAuthorIdx on GleambookMessages(authorId) TYPE btree;\nCREATE INDEX gbSenderLocIndex on GleambookMessages(senderLocation) TYPE rtree;\nCREATE INDEX gbMessageIdx on GleambookMessages(message) TYPE keyword;\n\nSELECT VALUE ds FROM Metadata.`Dataset` ds;\nSELECT VALUE ix FROM Metadata.`Index` ix;\n\nINSERT INTO ChirpUsers ([\n{\"screenName\":\"NathanGiesen@211\",\"lang\":\"en\",\"friendsCount\":18,\"statusesCount\":473,\"name\":\"Nathan Giesen\",\"followersCount\":49416},\n{\"screenName\":\"ColineGeyer@63\",\"lang\":\"en\",\"friendsCount\":121,\"statusesCount\":362,\"name\":\"Coline Geyer\",\"followersCount\":17159},\n{\"screenName\":\"NilaMilliron_tw\",\"lang\":\"en\",\"friendsCount\":445,\"statusesCount\":164,\"name\":\"Nila Milliron\",\"followersCount\":22649},\n{\"screenName\":\"ChangEwing_573\",\"lang\":\"en\",\"friendsCount\":182,\"statusesCount\":394,\"name\":\"Chang Ewing\",\"followersCount\":32136}\n]);\n\nINSERT INTO ChirpMessages ([\n{\"chirpId\":\"1\",\"user\":{\"screenName\":\"NathanGiesen@211\",\"lang\":\"en\",\"friendsCount\":39339,\"statusesCount\":473,\"name\":\"Nathan Giesen\",\"followersCount\":49416},\"senderLocation\":point(\"47.44,80.65\"),\"sendTime\":datetime(\"2008-04-26T10:10:00\"),\"referredTopics\":{{\"t-mobile\",\"customization\"}},\"messageText\":\" love t-mobile its customization is good:)\"},\n{\"chirpId\":\"2\",\"user\":{\"screenName\":\"ColineGeyer@63\",\"lang\":\"en\",\"friendsCount\":121,\"statusesCount\":362,\"name\":\"Coline Geyer\",\"followersCount\":17159},\"senderLocation\":point(\"32.84,67.14\"),\"sendTime\":datetime(\"2010-05-13T10:10:00\"),\"referredTopics\":{{\"verizon\",\"shortcut-menu\"}},\"messageText\":\" like verizon its shortcut-menu is awesome:)\"},\n{\"chirpId\":\"3\",\"user\":{\"screenName\":\"NathanGiesen@211\",\"lang\":\"en\",\"friendsCount\":39339,\"statusesCount\":473,\"name\":\"Nathan Giesen\",\"followersCount\":49416},\"senderLocation\":point(\"29.72,75.8\"),\"sendTime\":datetime(\"2006-11-04T10:10:00\"),\"referredTopics\":{{\"motorola\",\"speed\"}},\"messageText\":\" like motorola the speed is good:)\"},\n{\"chirpId\":\"4\",\"user\":{\"screenName\":\"NathanGiesen@211\",\"lang\":\"en\",\"friendsCount\":39339,\"statusesCount\":473,\"name\":\"Nathan Giesen\",\"followersCount\":49416},\"senderLocation\":point(\"39.28,70.48\"),\"sendTime\":datetime(\"2011-12-26T10:10:00\"),\"referredTopics\":{{\"sprint\",\"voice-command\"}},\"messageText\":\" like sprint the voice-command is mind-blowing:)\"},\n{\"chirpId\":\"5\",\"user\":{\"screenName\":\"NathanGiesen@211\",\"lang\":\"en\",\"friendsCount\":39339,\"statusesCount\":473,\"name\":\"Nathan Giesen\",\"followersCount\":49416},\"senderLocation\":point(\"40.09,92.69\"),\"sendTime\":datetime(\"2006-08-04T10:10:00\"),\"referredTopics\":{{\"motorola\",\"speed\"}},\"messageText\":\" can't stand motorola its speed is terrible:(\"},\n{\"chirpId\":\"6\",\"user\":{\"screenName\":\"ColineGeyer@63\",\"lang\":\"en\",\"friendsCount\":121,\"statusesCount\":362,\"name\":\"Coline Geyer\",\"followersCount\":17159},\"senderLocation\":point(\"47.51,83.99\"),\"sendTime\":datetime(\"2010-05-07T10:10:00\"),\"referredTopics\":{{\"iphone\",\"voice-clarity\"}},\"messageText\":\" like iphone the voice-clarity is good:)\"},\n{\"chirpId\":\"7\",\"user\":{\"screenName\":\"ChangEwing_573\",\"lang\":\"en\",\"friendsCount\":182,\"statusesCount\":394,\"name\":\"Chang Ewing\",\"followersCount\":32136},\"senderLocation\":point(\"36.21,72.6\"),\"sendTime\":datetime(\"2011-08-25T10:10:00\"),\"referredTopics\":{{\"samsung\",\"platform\"}},\"messageText\":\" like samsung the platform is good\"},\n{\"chirpId\":\"8\",\"user\":{\"screenName\":\"NathanGiesen@211\",\"lang\":\"en\",\"friendsCount\":39339,\"statusesCount\":473,\"name\":\"Nathan Giesen\",\"followersCount\":49416},\"senderLocation\":point(\"46.05,93.34\"),\"sendTime\":datetime(\"2005-10-14T10:10:00\"),\"referredTopics\":{{\"t-mobile\",\"shortcut-menu\"}},\"messageText\":\" like t-mobile the shortcut-menu is awesome:)\"},\n{\"chirpId\":\"9\",\"user\":{\"screenName\":\"NathanGiesen@211\",\"lang\":\"en\",\"friendsCount\":39339,\"statusesCount\":473,\"name\":\"Nathan Giesen\",\"followersCount\":49416},\"senderLocation\":point(\"36.86,74.62\"),\"sendTime\":datetime(\"2012-07-21T10:10:00\"),\"referredTopics\":{{\"verizon\",\"voicemail-service\"}},\"messageText\":\" love verizon its voicemail-service is awesome\"},\n{\"chirpId\":\"10\",\"user\":{\"screenName\":\"ColineGeyer@63\",\"lang\":\"en\",\"friendsCount\":121,\"statusesCount\":362,\"name\":\"Coline Geyer\",\"followersCount\":17159},\"senderLocation\":point(\"29.15,76.53\"),\"sendTime\":datetime(\"2008-01-26T10:10:00\"),\"referredTopics\":{{\"verizon\",\"voice-clarity\"}},\"messageText\":\" hate verizon its voice-clarity is OMG:(\"},\n{\"chirpId\":\"11\",\"user\":{\"screenName\":\"NilaMilliron_tw\",\"lang\":\"en\",\"friendsCount\":445,\"statusesCount\":164,\"name\":\"Nila Milliron\",\"followersCount\":22649},\"senderLocation\":point(\"37.59,68.42\"),\"sendTime\":datetime(\"2008-03-09T10:10:00\"),\"referredTopics\":{{\"iphone\",\"platform\"}},\"messageText\":\" can't stand iphone its platform is terrible\"},\n{\"chirpId\":\"12\",\"user\":{\"screenName\":\"OliJackson_512\",\"lang\":\"en\",\"friendsCount\":445,\"statusesCount\":164,\"name\":\"Oli Jackson\",\"followersCount\":22649},\"senderLocation\":point(\"24.82,94.63\"),\"sendTime\":datetime(\"2010-02-13T10:10:00\"),\"referredTopics\":{{\"samsung\",\"voice-command\"}},\"messageText\":\" like samsung the voice-command is amazing:)\"}\n]);\n\nINSERT INTO GleambookUsers ([\n{\"id\":1,\"alias\":\"Margarita\",\"name\":\"MargaritaStoddard\",\"nickname\":\"Mags\",\"userSince\":datetime(\"2012-08-20T10:10:00\"),\"friendIds\":{{2,3,6,10}},\"employment\":[{\"organizationName\":\"Codetechno\",\"startDate\":date(\"2006-08-06\")},{\"organizationName\":\"geomedia\",\"startDate\":date(\"2010-06-17\"),\"endDate\":date(\"2010-01-26\")}],\"gender\":\"F\"},\n{\"id\":2,\"alias\":\"Isbel\",\"name\":\"IsbelDull\",\"nickname\":\"Izzy\",\"userSince\":datetime(\"2011-01-22T10:10:00\"),\"friendIds\":{{1,4}},\"employment\":[{\"organizationName\":\"Hexviafind\",\"startDate\":date(\"2010-04-27\")}]},\n{\"id\":3,\"alias\":\"Emory\",\"name\":\"EmoryUnk\",\"userSince\":datetime(\"2012-07-10T10:10:00\"),\"friendIds\":{{1,5,8,9}},\"employment\":[{\"organizationName\":\"geomedia\",\"startDate\":date(\"2010-06-17\"),\"endDate\":date(\"2010-01-26\")}]},\n{\"id\":4,\"alias\":\"Nicholas\",\"name\":\"NicholasStroh\",\"userSince\":datetime(\"2010-12-27T10:10:00\"),\"friendIds\":{{2}},\"employment\":[{\"organizationName\":\"Zamcorporation\",\"startDate\":date(\"2010-06-08\")}]},\n{\"id\":5,\"alias\":\"Von\",\"name\":\"VonKemble\",\"userSince\":datetime(\"2010-01-05T10:10:00\"),\"friendIds\":{{3,6,10}},\"employment\":[{\"organizationName\":\"Kongreen\",\"startDate\":date(\"2010-11-27\")}]},\n{\"id\":6,\"alias\":\"Willis\",\"name\":\"WillisWynne\",\"userSince\":datetime(\"2005-01-17T10:10:00\"),\"friendIds\":{{1,3,7}},\"employment\":[{\"organizationName\":\"jaydax\",\"startDate\":date(\"2009-05-15\")}]},\n{\"id\":7,\"alias\":\"Suzanna\",\"name\":\"SuzannaTillson\",\"userSince\":datetime(\"2012-08-07T10:10:00\"),\"friendIds\":{{6}},\"employment\":[{\"organizationName\":\"Labzatron\",\"startDate\":date(\"2011-04-19\")}]},\n{\"id\":8,\"alias\":\"Nila\",\"name\":\"NilaMilliron\",\"userSince\":datetime(\"2008-01-01T10:10:00\"),\"friendIds\":{{3}},\"employment\":[{\"organizationName\":\"Plexlane\",\"startDate\":date(\"2010-02-28\")}]},\n{\"id\":9,\"alias\":\"Woodrow\",\"name\":\"WoodrowNehling\",\"nickname\":\"Woody\",\"userSince\":datetime(\"2005-09-20T10:10:00\"),\"friendIds\":{{3,10}},\"employment\":[{\"organizationName\":\"Zuncan\",\"startDate\":date(\"2003-04-22\"),\"endDate\":date(\"2009-12-13\")}]},\n{\"id\":10,\"alias\":\"Bram\",\"name\":\"BramHatch\",\"userSince\":datetime(\"2010-10-16T10:10:00\"),\"friendIds\":{{1,5,9}},\"employment\":[{\"organizationName\":\"physcane\",\"startDate\":date(\"2007-06-05\"),\"endDate\":date(\"2011-11-05\")}]}\n]);\n\nINSERT INTO GleambookMessages ([\n{\"messageId\":1,\"authorId\":3,\"inResponseTo\":2,\"senderLocation\":point(\"47.16,77.75\"),\"message\":\" love sprint its shortcut-menu is awesome:)\"},\n{\"messageId\":2,\"authorId\":1,\"inResponseTo\":4,\"senderLocation\":point(\"41.66,80.87\"),\"message\":\" dislike iphone its touch-screen is horrible\"},\n{\"messageId\":3,\"authorId\":2,\"inResponseTo\":4,\"senderLocation\":point(\"48.09,81.01\"),\"message\":\" like samsung the plan is amazing\"},\n{\"messageId\":4,\"authorId\":1,\"inResponseTo\":2,\"senderLocation\":point(\"37.73,97.04\"),\"message\":\" can't stand at&t the network is horrible:(\"},\n{\"messageId\":5,\"authorId\":6,\"inResponseTo\":2,\"senderLocation\":point(\"34.7,90.76\"),\"message\":\" love sprint the customization is mind-blowing\"},\n{\"messageId\":6,\"authorId\":2,\"inResponseTo\":1,\"senderLocation\":point(\"31.5,75.56\"),\"message\":\" like t-mobile its platform is mind-blowing\"},\n{\"messageId\":7,\"authorId\":5,\"inResponseTo\":15,\"senderLocation\":point(\"32.91,85.05\"),\"message\":\" dislike sprint the speed is horrible\"},\n{\"messageId\":8,\"authorId\":1,\"inResponseTo\":11,\"senderLocation\":point(\"40.33,80.87\"),\"message\":\" like verizon the 3G is awesome:)\"},\n{\"messageId\":9,\"authorId\":3,\"inResponseTo\":12,\"senderLocation\":point(\"34.45,96.48\"),\"message\":\" love verizon its wireless is good\"},\n{\"messageId\":10,\"authorId\":1,\"inResponseTo\":12,\"senderLocation\":point(\"42.5,70.01\"),\"message\":\" can't stand motorola the touch-screen is terrible\"},\n{\"messageId\":11,\"authorId\":1,\"inResponseTo\":1,\"senderLocation\":point(\"38.97,77.49\"),\"message\":\" can't stand at&t its plan is terrible\"},\n{\"messageId\":12,\"authorId\":10,\"inResponseTo\":6,\"senderLocation\":point(\"42.26,77.76\"),\"message\":\" can't stand t-mobile its voicemail-service is OMG:(\"},\n{\"messageId\":13,\"authorId\":10,\"inResponseTo\":4,\"senderLocation\":point(\"42.77,78.92\"),\"message\":\" dislike iphone the voice-command is bad:(\"},\n{\"messageId\":14,\"authorId\":9,\"inResponseTo\":12,\"senderLocation\":point(\"41.33,85.28\"),\"message\":\" love at&t its 3G is good:)\"},\n{\"messageId\":15,\"authorId\":7,\"inResponseTo\":11,\"senderLocation\":point(\"44.47,67.11\"),\"message\":\" like iphone the voicemail-service is awesome\"}\n]);\n\nSELECT VALUE user\nFROM GleambookUsers user\nWHERE user.id = 8;\n\nSELECT VALUE user\nFROM GleambookUsers user\nWHERE user.id >= 2 AND user.id <= 4;\n\nSELECT VALUE user\nFROM GleambookUsers user\nWHERE user.userSince >= datetime('2010-07-22T00:00:00')\n  AND user.userSince <= datetime('2012-07-29T23:59:59');\n\nSELECT user.name AS uname, msg.message AS message\nFROM GleambookUsers user, GleambookMessages msg\nWHERE msg.authorId = user.id;\n\nSELECT *\nFROM GleambookUsers user, GleambookMessages msg\nWHERE msg.authorId = user.id;\n\nSELECT VALUE {\"user\": user, \"message\": msg}\nFROM GleambookUsers user, GleambookMessages msg\nWHERE msg.authorId = user.id;\n\nSELECT user.name AS uname, msg.message AS message\nFROM GleambookUsers user, GleambookMessages msg\nWHERE msg.authorId /*+ indexnl */ = user.id;\n\nSELECT user.name AS uname,\n       (SELECT VALUE msg.message\n        FROM GleambookMessages msg\n        WHERE msg.authorId = user.id) AS messages\nFROM GleambookUsers user;\n\nSELECT cm1.messageText AS message,\n       (SELECT VALUE cm2.messageText\n        FROM ChirpMessages cm2\n        WHERE `spatial-distance`(cm1.senderLocation, cm2.senderLocation) <= 1\n          AND cm2.chirpId < cm1.chirpId) AS nearbyMessages\nFROM ChirpMessages cm1;\n\nSET simfunction \"edit-distance\";\nSET simthreshold \"3\";\n\nSELECT gbu.id AS id, gbu.name AS name,\n       (SELECT cm.user.screenName AS chirpScreenname,\n               cm.user.name AS chirpName\n        FROM ChirpMessages cm\n        WHERE cm.user.name ~= gbu.name) AS similarUsers\nFROM GleambookUsers gbu;\n\nSELECT VALUE gbu\nFROM GleambookUsers gbu\nWHERE (SOME e IN gbu.employment SATISFIES e.endDate IS UNKNOWN);\n\nSELECT VALUE gbu\nFROM GleambookUsers gbu\nWHERE (EVERY e IN gbu.employment SATISFIES e.endDate IS NOT UNKNOWN);\n\nSELECT COUNT(gbu) AS numUsers FROM GleambookUsers gbu;\n\nSELECT VALUE COUNT(gbu) FROM GleambookUsers gbu;\n\nSELECT uid AS user, COUNT(cm) AS count\nFROM ChirpMessages cm\nGROUP BY cm.user.screenName AS uid;\n\nSELECT uid AS user, COUNT(cm) AS count\nFROM ChirpMessages cm\n /*+ hash */\nGROUP BY cm.user.screenName AS uid;\n\nSELECT uid AS user, c AS count\nFROM ChirpMessages cm\nGROUP BY cm.user.screenName AS uid WITH c AS count(cm)\nORDER BY c DESC\nLIMIT 3;\n\nSET simfunction \"jaccard\";\nSET simthreshold \"0.3\";\n\nSELECT cm1 AS chirp,\n       (SELECT VALUE cm2.chirpId\n        FROM ChirpMessages cm2\n        WHERE cm2.referredTopics ~= cm1.referredTopics\n          AND cm2.chirpId > cm1.chirpId) AS similarChirps\nFROM ChirpMessages cm1;\n\nINSERT INTO ChirpMessages\n(\n   {\"chirpId\": \"13\",\n    \"user\":\n        {\"screenName\": \"NathanGiesen@211\",\n         \"lang\": \"en\",\n         \"friendsCount\": 39345,\n         \"statusesCount\": 479,\n         \"name\": \"Nathan Giesen\",\n         \"followersCount\": 49420\n        },\n    \"senderLocation\": point(\"47.44,80.65\"),\n    \"sendTime\": datetime(\"2008-04-26T10:10:35\"),\n    \"referredTopics\": {{\"chirping\"}},\n    \"messageText\": \"chirpy chirp, my fellow chirpers!\"\n   }\n);\n\nSELECT VALUE cm FROM ChirpMessages cm WHERE cm.chirpId = \"13\";\n\nDELETE FROM ChirpMessages cm WHERE cm.chirpId = \"13\";\n\n\n", "encoding": "ascii"}