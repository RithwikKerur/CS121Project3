{"url": "https://www.ics.uci.edu/~smyth/courses/stats5/onlineslides/RCode_for_Feb6th_Lecture/STAT5_GuassianMixture.R", "content": "\r\n##### gif animation for simulated data. Gaussian Mixture model, EM algorithm\r\n#choose your path that you will store the figures. Here is MINE\r\nsetwd(\"Z:/teaching/stat240/2016/Image/GM_Sim\")\r\nset.seed(1);\r\nx=c(rnorm(8,1), rnorm(12,3))\r\nn=length(x)\r\nz=rbinom(n,1,0.5)\r\nk0=c(1:n)[!z]\r\nk1=setdiff(1:n, k0)\r\np.old=mean(z)\r\nu.old=c(mean(x[k0]), mean(x[k1]) )\r\nsd.old=c(sd(x[k0]), sd(x[k1]) )\r\np.new=p.old\r\nu.new=u.old\r\nsd.new=sd.old\r\n\r\ni=0\r\nwhile(i==0 || max(abs(u.new-u.old))>0.0001) \r\n{\r\np.old=p.new\r\nu.old=u.new\r\nsd.old=sd.new\r\n\r\n#e-step\r\nez1=p.old*dnorm(x, u.old[2], sd.old[2]) / \r\n\t((1-p.new)*dnorm(x, u.old[1], sd.old[1]) + p.old*dnorm(x, u.old[2], sd.old[2]))\r\nez0=1-ez1\r\n\r\n#m-step\r\np.new=mean(ez1)\r\nu.new=c( weighted.mean(x, ez0), weighted.mean(x, ez1))\r\nsd.new=c( sqrt(weighted.mean((x-u.new[1])^2, ez0)) , \r\n\tsqrt(weighted.mean((x-u.new[2])^2, ez1)))\r\n\r\ni=i+1\r\nif(i==1) cat(\"\\t\", \"p \\t\", \"u0 \\t\", \"u1 \\n\")\r\ncat(\"iteration\", i, \"\\n\")\r\nprint(c(p.new, u.new))\r\n\r\n if (i < 10) {name = paste('000',i,'plot.png',sep='')}\r\n if (i < 100 && i >= 10) {name = paste('00',i,'plot.png', sep='')}\r\n if (i >= 100) {name = paste('0', i,'plot.png', sep='')}\r\n png(name)\r\n tmp=rbind(ez1,1-ez1)\r\n colnames(tmp)=1:n\r\n barplot(tmp, ylim=c(0,1),col=c(2,4),main=paste(\"Estimated Prob from EM: iteration=\", i),ylab=\"prob\")\r\n dev.off()\r\n}\r\n#\"H:\\teaching\\stat240\\2016\\Image\\Iris\\GM_Sim\\magick *.png -delay 3 -loop 0 GM_EM.gif\"\r\n\r\n\r\n##### gif animation for iris data. Gaussian Mixture model, EM algorithm\r\n### two species: Setosa, Versicolor. One variable: petal length\r\nlibrary(MASS)\r\nsetwd(\"Z:/teaching/stat240/2016/Image/Iris\")\r\nset.seed(1);\r\nx=c(iris3[,3,1],iris3[,3,2])\r\nn=length(x)\r\nz=rbinom(n,1,0.5)\r\nk0=c(1:n)[!z]\r\nk1=setdiff(1:n, k0)\r\np.old=mean(z)\r\nu.old=c(mean(x[k0]), mean(x[k1]) )\r\nsd.old=c(sd(x[k0]), sd(x[k1]) )\r\np.new=p.old\r\nu.new=u.old\r\nsd.new=sd.old\r\n\r\ni=0\r\nwhile(i==0 || max(abs(u.new-u.old))>0.0001) \r\n{\r\np.old=p.new\r\nu.old=u.new\r\nsd.old=sd.new\r\n\r\n#e-step\r\nez1=p.old*dnorm(x, u.old[2], sd.old[2]) / \r\n\t((1-p.new)*dnorm(x, u.old[1], sd.old[1]) + p.old*dnorm(x, u.old[2], sd.old[2]))\r\nez0=1-ez1\r\n\r\n#m-step\r\np.new=mean(ez1)\r\nu.new=c( weighted.mean(x, ez0), weighted.mean(x, ez1))\r\nsd.new=c( sqrt(weighted.mean((x-u.new[1])^2, ez0)) , \r\n\tsqrt(weighted.mean((x-u.new[2])^2, ez1)))\r\n\r\ni=i+1\r\nif(i==1) cat(\"\\t\", \"p \\t\", \"u0 \\t\", \"u1 \\n\")\r\ncat(\"iteration\", i, \"\\n\")\r\nprint(c(p.new, u.new))\r\n\r\n if (i < 10) {name = paste('000',i,'plot.png',sep='')}\r\n if (i < 100 && i >= 10) {name = paste('00',i,'plot.png', sep='')}\r\n if (i >= 100) {name = paste('0', i,'plot.png', sep='')}\r\n png(name)\r\n tmp=rbind(ez1,1-ez1)\r\n colnames(tmp)=1:n\r\n barplot(tmp, ylim=c(0,1),col=c(2,4),main=paste(\"Estimated Prob (Iris Data): iteration=\", i),ylab=\"prob\")\r\n dev.off()\r\n}\r\n\r\n#\"H:\\teaching\\stat240\\2016\\Image\\Iris\\magick *.png -delay 3 -loop 0 GM_EM.gif\"\r\n\r\n\r\n", "encoding": "ascii"}