{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/Ch10/Ch10Rcode.txt", "content": "## Chapter 10: Correlated data\n\n\n\n## Variability of IL-1beta in healthy patients\nSalivadata <- read.table (file=\"H:\\\\MyDocuments\\\\BAYES\\\\CorrelatedNormalData\\\\IL1beta\\\\IL1bData.txt\", header=T, sep=\"\\t\")\nattach(Salivadata)\nSalivadata\noptions(contrasts=c(\"contr.treatment\",\"contr.poly\"))\n\n\n#### Original Variables\n#ID\ty\n####\n\n#### Created Variables\nlogy <- log(y)\n####\n\n\n#### Libraries\nlibrary(lattice)\nlibrary(R2WinBUGS)\n####\n\n\n\n\n################################\n## Sample correlation matrix  ##\n## for the IL-1beta data      ##\n## that appears in  Sect 10.1 ##\n################################\nTime <- rep(c(1,2,3,4,5,6),30)\nround(cor(matrix(c(logy[Time==1],logy[Time==2],logy[Time==3],logy[Time==4],logy[Time==5],logy[Time==6]),30,6)),2)\n\n\n\n\n\n\n################################\n## FIGURE 10.1                ##               \n## Trellis plot               ##\n## for the IL-1beta data      ##\n## that appears in  Sect 10.1 ##\n################################\nTime <- rep(c(1,2,3,4,5,6),30)\nxyplot(logy~Time | ID, layout=c(6,5), as.table=T, xlab=\"Day\", ylab=expression(paste(\"log IL-1\", beta)), strip=FALSE,\n               panel=function(x,y){panel.xyplot(x,y,col=1); panel.loess(x,y, span=0.80,col=1)})\n        \n\n\n\n################################\n## FIGURE 10.2                ##               \n## Boxplots and Percentiles   ##\n## for the IL-1beta data      ##\n################################\n\n## Boxplots and Percentiles\nround(quantile(y,c(0.01,0.02,0.05,0.10,0.50,0.90,0.95,0.98,0.99)),2)\n\nTime <- rep(c(1,2,3,4,5,6),30)\nTime2 <- factor(Time,labels=c(\"1\",\"2\",\"3\",\"4\",\"5\",\"6\")) \n\nboxplot(logy~Time2,range=0,style.bxp=\"old\",boxwex = 0.5, ylab=\"\", xlab=\"\",xlim=c(.5,6.5))\nlines(rep(1.35,30),   logy[Time==1],type=\"p\")\nlines(rep(2.35,30), logy[Time==2],type=\"p\")\nlines(rep(3.35,30),   logy[Time==3],type=\"p\")\nlines(rep(4.35,30), logy[Time==4],type=\"p\")\nlines(rep(5.35,30),  logy[Time==5],type=\"p\")\nlines(rep(6.35,30),logy[Time==6],type=\"p\")\nmtext(\"Day\",line=2.5,side=1)\nmtext(\"log IL-1\",line=2.5,at=1, side=2)\nmtext(expression(beta),line=2.5,at=1.58,side=2)\n\n\n\n\n\n\n################################\n## FIGURE 10.3                ##               \n## Spaghetti plot             ##\n## for the IL-1beta data      ##\n################################\nTime <- rep(c(1,2,3,4,5,6),30)\nT <- c(1,2,3,4,5,6)\nplot(T,c(mean(logy[Time==1]),mean(logy[Time==2]),mean(logy[Time==3]),mean(logy[Time==4]),\n         mean(logy[Time==5]),mean(logy[Time==6])),xlab=\"Day\", ylab=\"\", type='o', cex=2, lwd=3, ylim=c(-2.5,5))\nfor(i in 1:30){lines(T,logy[ID==i], lty=2)}\nmtext(\"log IL-1\",line=2.5,at=1, side=2)\nmtext(expression(beta),line=2.5,at=1.58,side=2)\n\n\n\n\n\n\n###########################################\n## Example 10.2.1 and Exercise 10.3      ##\n## One way random effects model          ##\n## FIGURE 10.4 and TABLE 10.1            ##\n## IL-1beta data                         ##\n###########################################\nlibrary(R2WinBUGS)\n\nILdata <- list(\"y\",\"ID\")\nparameters <- c(\"mu\",\"sigma\",\"sigmab\",\"tau\",\"taub\",\"rho\",\"b\",\"bf\",\"muf\",\"L\",\"U\",\"yf\",\"logyf\") \ninits <- list( list(mu=0,sigma=1,sigmab=1))\nIL.fit <- bugs(ILdata, inits, parameters,\"CSModel.txt\", \n                 working.directory = \"F:\\\\MyDocuments\\\\BAYES\\\\CorrelatedNormalData\\\\IL1beta\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\n\nprint(IL.fit,digits=3)\nattach.bugs(IL.fit)\n\n### Plot distribution of muf\nplot(density(muf), type='l', xlab=expression(mu[f]), main=\"\", ylab=\"Predictive density\", lwd=3)\n\n### Plot predictive distribution of yf. \n### FIGURE 10.4.\nplot(density(yf, n=2500, from=0, bw=0.5), type='l', xlab=\"\", xlim=c(0,45), main=\"\", ylab=\"Predictive density\", lwd=3)\nlines(c(0,0),c(0,  4.789715e-02),lwd=3,lty=1)\nrug(quantile(yf, c(0.90,0.95)))\nmtext(\"23.65\",side=1,at=24)\nmtext(\"37.77\",side=1,at=37)\n\n### TABLE 10.1\nquantile(sigma, c(0.025,0.50,0.975))\nquantile(sigmab, c(0.025,0.50,0.975))\nquantile(rho, c(0.025,0.50,0.975))\nquantile(mu, c(0.025,0.50,0.975))\nquantile(logyf, c(0.025,0.50,0.975))\nquantile(muf, c(0.025,0.50,0.975))\nquantile(L, c(0.025,0.50,0.975))\nquantile(U, c(0.025,0.50,0.975))\nquantile(exp(mu), c(0.025,0.50,0.975))\nquantile(yf, c(0.025,0.50,0.975))\nquantile(exp(muf), c(0.025,0.50,0.975))\nquantile(exp(L), c(0.025,0.50,0.975))\nquantile(exp(U), c(0.025,0.50,0.975))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n###########################################\n## Example 10.2.2                        ##\n## Randomized block design               ##\n## Dog data from Rice book 1st ed P 479  ##\n## Dog is a fixed effect (ch 9 methods)  ##\n###########################################\noptions(contrasts=c(\"contr.treatment\",\"contr.poly\"))\nDog <- c(1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10)\nTreatment <- c(1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3)\nConcentration <- c(0.28,0.3,1.07,0.51,0.39,1.35,1,0.63,0.69,0.39,0.68,0.28,0.29,0.38,1.24,\n  0.36,0.21,1.53,0.32,0.88,0.49,0.69,0.39,0.5,0.17,0.51,1.02,0.33,0.32,0.3)\nc(mean(Concentration[Treatment==1]), mean(Concentration[Treatment==2]), mean(Concentration[Treatment==3]))\ng <- factor(Dog)\nTrt <- factor(Treatment)\nfit <- aov(Concentration~Trt+g) \nsummary(fit)\nTukeyHSD(fit)\n\n\nDog <- read.table(\"H:\\\\MyDocuments\\\\BAYES\\\\CorrelatedNormalData\\\\DogExample\\\\DogDataLinRegVersion.txt\", header=T, sep=\"\\t\")\nattach(Dog)\nDog\n\nlibrary(R2WinBUGS)\n\nDogdata <- list(\"D1\", \"D2\", \"D3\", \"D4\", \"D5\", \"D6\", \"D7\", \"D8\", \"D9\", \"D10\", \"I\", \"H\", \"Concentration\")\nparameters <- c(\"beta\",\"tau\",\"diff12\",\"diff13\",\"diff23\") \ninits <- list( list(beta=c(0,0,0,0,0,0,0,0,0,0,0,0), tau=1))\nDog.fit <- bugs(Dogdata, inits, parameters,\"DogCode.txt\", \n                 working.directory = \"H:\\\\MyDocuments\\\\BAYES\\\\CorrelatedNormalData\\\\DogExample\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\nprint(Dog.fit,digits=3)\nattach.bugs(Dog.fit)\n\n\n\n\n\n###########################################\n## Exercise 10.7                         ##\n## Randomized block design               ##\n## Dog data from Rice book 1st ed P 479  ##\n## Dog is a random effect                ##\n###########################################\nI <- c(1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0)\nH <- c(0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0)\nC <- c(0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1)\nDog <- c(1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10)\nTreatment <- c(1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3)  #Treatment 1 is I; Treatment 2 is H; Treatment 3 is C\nConc <- c(0.28,0.3,1.07,0.51,0.39,1.35,1,0.63,0.69,0.39,0.68,0.28,0.29,0.38,1.24,\n          0.36,0.21,1.53,0.32,0.88,0.49,0.69,0.39,0.5,0.17,0.51,1.02,0.33,0.32,0.3)\nlibrary(nlme)\nm1 <- lme(Conc ~ -1 + I + H + C , random=~1|Dog)\nsummary(m1)\nintervals(m1)\n\n\n\nlibrary(R2WinBUGS)\nDogdata1 <- list(\"Dog\", \"Treatment\", \"Conc\")\nparameters1 <- c(\"b\",\"tau\",\"taub\", \"sigmab\", \"sigma\", \"beta\", \"diff12\",\"diff13\",\"diff23\") \ninits1 <- list( list(b=c(0,0,0,0,0,0,0,0,0,0), tau=1, sigmab=1, beta=c(0,0,0)))\nDog.fit1 <- bugs(Dogdata1, inits1, parameters1,\"DogMixedModel.txt\", \n                 working.directory = \"F:\\\\MyDocuments\\\\BAYES\\\\CorrelatedNormalData\\\\DogExample\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\nprint(Dog.fit1,digits=3)\nattach.bugs(Dog.fit1)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n###########################################\n## Exercise 10.8.  Fuel flow rate data.  ##\n## Randomized block design               ##\n## Data from Scheffe book P. 289         ##\n###########################################\n\nOperator <- c(rep(1,9), rep(2,9), rep(3,9), rep(4,9), rep(5,9))\nNozzle <- rep(c(1,1,1,2,2,2,3,3,3), 5) \nRate <- c(6,6,-15,13,6,13,10,10,-11,  26,12,5,4,4,11,-35,0,-14,   11,4,4,17,10,17,11,-10,-17,    21,14,7,-5,2,-5,12,-2,-16,   25,18,25,15,8,1,-4,10,24)\ncbind(Operator,Nozzle,Rate)\n\n\n\n\n\n\n\n\n########################################\n## Hierarchical models: Meta-analysis ##\n## Example 10.2.3 and Exercise 10.10  ##\n## See WinBUGS code for Ch 10         ##\n########################################\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n###########################################\n## Example 10.2.4                        ##\n## Table 10.4                            ##\n## Figures 10.5 and 10.6                 ##\n## Exercise 10.11                        ##\n## Dental data                           ##\n## Random slopes and intercepts          ##\n###########################################\n\nDentaldata<- read.table(\"H:\\\\MyDocuments\\\\BAYES\\\\CorrelatedNormalData\\\\Dental\\\\DentalData.txt\",header=T,sep=\"\\t\")\nattach(Dentaldata)\nDentaldata\noptions(contrasts=c(\"contr.treatment\",\"contr.poly\"))\n\n\n#### Original Variables\n# Distance \tAge\tID\tMale\tID1\n####\n\n#### Libraries\nlibrary(lattice)\n####\n\n\n## Correlation matrix\nround(cor(matrix(c(Distance[Age==8],Distance[Age==10],Distance[Age==12],Distance[Age==14]),27,4)),2)\n\n\n## Trellis plot\nxyplot(Distance~Age | ID1, layout=c(4,4), as.table=T, type='o', col=1, cex=1, strip=FALSE)\nxyplot(Distance~Age | ID1, layout=c(4,4), as.table=T, type='o', col=1, cex=1, strip=FALSE, subset=Male==1)\nxyplot(Distance~Age | ID1, layout=c(4,3), as.table=T, type='o', col=1, cex=1, strip=FALSE, subset=Male==0)\n\n\n## FIGURE 10.5.  Spaghetti plot\nT <- c(8,10,12,14)\nplot(T,c(mean(Distance[Age==8  & Male==1]),mean(Distance[Age==10 & Male==1]),\n         mean(Distance[Age==14 & Male==1]),mean(Distance[Age==14 & Male==1])),\n         xlab=\"Age (years)\", ylab=\"Distance (mm)\", type='o', cex=2, lwd=3, ylim=c(15,35))\nlines(T,c(mean(Distance[Age==8  & Male==0]),mean(Distance[Age==10 & Male==0]),\n         mean(Distance[Age==14 & Male==0]),mean(Distance[Age==14 & Male==0])), type=\"o\", lty=2, lwd=3, cex=2)\nfor(i in 1:16){lines(T,Distance[ID1==i], lty=1)}\nfor(i in 17:27){lines(T,Distance[ID1==i], lty=2)}\nlegend(\"bottomright\",c(\"Boys\",\"Girls\"),lty=1:2)\n\n\n\n\n\n\n\n\n\n\n## Example 10.2.4.  Bayesian random intercept, random slope mixed model\nDistance1 <- matrix(Distance,27,4,byrow=T)\nR <- matrix(c(.001,0,0,.001),2,2)\nmu0 <- c(0,0)\nMale1 <- c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0)\nAge1 <- c(8,10,12,14)\n\nlibrary(R2WinBUGS)\n\nDenData <- list(\"Distance1\", \"R\", \"mu0\", \"Male1\", \"Age1\")\nparameters <- c(\"beta\",\"tau\",\"sigma\",\"m\") \ninits <- list( list(beta=c(0,0,0), tau=1, prec=structure(.Data=c(.001,0,0,.001),.Dim=c(2,2))))\nDental.fit <- bugs(DenData, inits, parameters,\"DentalWBcode.txt\", \n                 working.directory = \"F:\\\\MyDocuments\\\\BAYES\\\\CorrelatedNormalData\\\\Dental\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\nprint(Dental.fit,digits=3)\nattach.bugs(Dental.fit)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Ventilation data.  Exercise 10.15\n\nTemperature=c(-10,25,37,50,65,80)\nvent <- c(\n74.5,\t81.5,\t83.6,\t68.6,\t73.1,\t79.4,\n75.5,\t84.6,\t70.6,\t87.3,\t73.0,\t75.0,\n68.9,\t71.6,\t55.9,\t61.9,\t60.5,\t61.8,\n57.0,\t61.3,\t54.1,\t59.2,\t56.6,\t58.8,\n78.3,\t84.9,\t64.0,\t62.2,\t60.1,\t78.7,\n54.0,\t62.8,\t63.0,\t58.0,\t56.0,\t51.5,\n72.5,\t68.3,\t67.8,\t71.5,\t65.0,\t67.7,\n80.8,\t89.9,\t83.2,\t83.0,\t85.7,\t79.6)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "encoding": "ascii"}