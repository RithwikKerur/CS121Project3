{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/Ch5/SampleSizeRcode.txt", "content": "## Sample size for two binomial proportions.  Target parameter is relative risk.\n\n\n\n##### Predictive probability (Table 5.7)\nlibrary(R2WinBUGS)\n\nSampleSizeProportions <- function(m,n1,n2,theta1T,theta2T,TrueRR,alpha){\n  \n power1 <- rep(NA,m)\n coverage1 <- rep(NA,m)\n length1 <- rep(NA,m)\n \nfor(i in 1:m)\n {\n   y1 <- rbinom(1,n1,theta1T)\n   y2 <- rbinom(1,n2,theta2T)\n   binomialdata <- list(\"n1\",\"n2\",\"y1\",\"y2\")\n   parameters <- c(\"RR\", \"HT\") \n   inits <- list( list(theta1=0.5,theta2=0.5))\n   SampleSize <- bugs(binomialdata, inits, parameters,\"SampleSizeProportions.txt\", \n                 working.directory = \"F:\\\\MyDocuments\\\\BAYES\\\\OneandTwoSample\\\\Code\", \n                 n.chains=1, n.iter=2000, n.thin=1, n.burnin=0, save.history=FALSE)\n   power1[i] <-  SampleSize$summary[2,1]\n   length1[i] <- SampleSize$summary[1,7] - SampleSize$summary[1,3]\n   coverage1[i]<-(TrueRR>=SampleSize$summary[1,3])&(TrueRR<=SampleSize$summary[1,7])\n }\nAveragePower <- mean(power1)\nPredProb <- c( mean(power1>alpha[1]), mean(power1>alpha[2]), mean(power1>alpha[3]) )\nAverageLength <- mean(length1)\nAverageCoverage <- mean(coverage1)\n\nreturn(c(PredProb, AveragePower,AverageLength,AverageCoverage))\n}\n\n\n\n# RR=1.25\nSampleSizeProportions(m=1000,   n1=50,n2=50,      theta1T=0.25,theta2T=0.2,TrueRR=1.25,       alpha=c(0.80,0.90,0.95))\n\nSampleSizeProportions(m=1000,   n1=100,n2=100,    theta1T=0.25,theta2T=0.2,TrueRR=1.25,       alpha=c(0.80,0.90,0.95))\n\nSampleSizeProportions(m=1000,   n1=150,n2=150,    theta1T=0.25,theta2T=0.2,TrueRR=1.25,       alpha=c(0.80,0.90,0.95))\n\nSampleSizeProportions(m=1000,   n1=200,n2=200,    theta1T=0.25,theta2T=0.2,TrueRR=1.25,       alpha=c(0.80,0.90,0.95))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n##### Average Power\nlibrary(R2WinBUGS)\n\nSampleSizeProportions <- function(m,n1,n2,a1,b1,a2,b2,alpha){\n  \n power1 <- rep(NA,m)\n coverage1 <- rep(NA,m)\n length1 <- rep(NA,m)\n \n for(i in 1:m)\n {\n   theta1 <- rbeta(1,a1,b1)\n   theta2 <- rbeta(1,a2,b2)\n   y1 <- rbinom(1,n1,theta1)\n   y2 <- rbinom(1,n2,theta2)\n   TrueRR <- theta1/theta2\n   binomialdata <- list(\"n1\",\"n2\",\"y1\",\"y2\")\n   parameters <- c(\"RR\", \"HT\") \n   inits <- list( list(theta1=0.5,theta2=0.5))\n   SampleSize <- bugs(binomialdata, inits, parameters,\"SampleSizeProportions.txt\", \n                 working.directory = \"F:\\\\MyDocuments\\\\BAYES\\\\OneandTwoSample\\\\Code\", \n                 n.chains=1, n.iter=2000, n.thin=1, n.burnin=0, save.history=FALSE)\n   power1[i] <-  SampleSize$summary[2,1]\n   #power1[i] <- mean(SampleSize$sims.list$RR > nullvalue)\n   length1[i] <- SampleSize$summary[1,7] - SampleSize$summary[1,3]\n   coverage1[i]<-(TrueRR>=SampleSize$summary[1,3])&(TrueRR<=SampleSize$summary[1,7])\n }\nAveragePower <- mean(power1)\nPredProb <- c( mean(power1>alpha[1]), mean(power1>alpha[2]), mean(power1>alpha[3]) )\nAverageLength <- mean(length1)\nAverageCoverage <- mean(coverage1)\n\nreturn(c(AveragePower,PredProb, AverageLength,AverageCoverage))\n}\n\n\n\n\n# RR=1.75\nSampleSizeProportions(m=1000,   n1=50,n2=50,      a2=23.36,b2=90.45,   a1=8.50,b1=14.92,   alpha=c(0.80,0.90,0.95))\n\nSampleSizeProportions(m=1000,   n1=100,n2=100,    a2=23.36,b2=90.45,   a1=8.50,b1=14.92,   alpha=c(0.80,0.90,0.95))\n\nSampleSizeProportions(m=1000,   n1=150,n2=150,    a2=23.36,b2=90.45,   a1=8.50,b1=14.92,   alpha=c(0.80,0.90,0.95))\n\nSampleSizeProportions(m=1000,   n1=200,n2=200,    a2=23.36,b2=90.45,   a1=8.50,b1=14.92,   alpha=c(0.80,0.90,0.95))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "encoding": "ascii"}