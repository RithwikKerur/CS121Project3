{"url": "https://www.ics.uci.edu/~majumder/VC/211HW3/vlfeat/toolbox/misc/samplinthist.tc", "content": "#define JOIN_(a,b) a ## b\n#define JOIN(a,b) JOIN_(a,b)\n\n#undef SAMPLE\n#define SAMPLE JOIN(sample_, SFX)\n\nVL_INLINE void\nSAMPLE (T* histPt,\n        T const* intHistPt,\n        vl_size width, vl_size height, vl_size numLabels,\n        vl_uint32 const* boxesPt,\n        vl_size numBoxes)\n{\n  vl_uindex bi, k ;\n  for (bi = 0 ; bi < numBoxes ; ++ bi) {\n    vl_uint32 x1 = *boxesPt++ ;\n    vl_uint32 y1 = *boxesPt++ ;\n    vl_uint32 x2 = *boxesPt++ ;\n    vl_uint32 y2 = *boxesPt++ ;\n    vl_uint32 stride = width ;\n    vl_uint32 labelStride = width * height ;\n    T const* iter = 0 ;\n\n    /* empty box case */\n    if (x1 > x2 || y1 > y2) {\n      for (k = 0 ; k < numLabels ; ++k) {\n        histPt [k] = 0 ;\n      }\n      histPt += numLabels ;\n      continue ;\n    }\n\n    if (x1 < 1  || y1 < 1) {\n      vlmxError(vlmxErrInconsistentData,\n               \"Box %d is out of bounds.\", bi + 1) ;\n    }\n    if (x2 > width || y2 > height) {\n      vlmxError(vlmxErrInconsistentData,\n               \"Box %d is out of bounds.\", bi + 1) ;\n    }\n\n    -- x1 ;\n    -- x2 ;\n    -- y1 ;\n    -- y2 ;\n\n    iter = intHistPt + x2 + y2 * stride ;\n    for (k = 0 ; k < numLabels ; ++k) {\n      histPt [k] = *iter ;\n      iter += labelStride ;\n    }\n\n    if (x1 > 0) {\n      iter = intHistPt + (x1 - 1) + y2 * stride ;\n      for (k = 0 ; k < numLabels ; ++k) {\n        histPt [k] -= *iter ;\n        iter += labelStride ;\n      }\n    }\n\n    if (x1 > 0 && y1 > 0) {\n      iter = intHistPt + (x1 - 1) + (y1 - 1) * stride ;\n      for (k = 0 ; k < numLabels ; ++k) {\n        histPt [k] += *iter ;\n        iter += labelStride ;\n      }\n    }\n\n    if (y1 > 0) {\n      iter = intHistPt + x2 + (y1 - 1) * stride ;\n      for (k = 0 ; k < numLabels ; ++k) {\n        histPt [k] -= *iter ;\n        iter += labelStride ;\n      }\n    }\n    histPt += numLabels ;\n  }\n}\n", "encoding": "ascii"}