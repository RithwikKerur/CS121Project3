{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/Ch13/Ch13RcodeLeukemia.txt", "content": "#***************************************************************#\n# R code for the leukemia analysis in Ch 13.                    #\n#***************************************************************#\n\n\nlibrary(survival)\nlibrary(xlsReadWrite)\nlibrary(R2WinBUGS)\n\n## R2WinBUGS to fit the 2 group exponential model \n# Group 1 is AG+\n# Group 2 is AG-\nlibrary(R2WinBUGS)\nn <- c(17,16)\na1 <- 0.0001\nb1 <- 0.0001\na2 <- 0.0001\nb2 <- 0.0001\nt1 <- c(65,156,100,134,16,108,121,4,39,143,56,26,22,1,1,5,65)\nt2 <- c(56,65,17,7,16,22,3,4,2,3,8,4,3,30,4,43)\nleukemiadata <- list(\"n\",\"t1\",\"t2\",\"a1\",\"b1\",\"a2\",\"b2\")\nparameters <- c(\"theta1\",\"theta2\",\"median1\",\"median2\",\"relmedian\",\"S\",\"Sdiff\") \ninits <- list( list(theta1=0.05, theta2=0.02))\n\nleuk.fit <- bugs(leukemiadata, inits, parameters,\"leukemia.txt\", \n                 working.directory = \"H:\\\\MyDocuments\\\\BAYES\\\\SurvivalRegression\\\\Leukemia\", \n                 n.chains=1, n.iter=50000, n.thin=1, n.burnin=0)\nround(print(leuk.fit),3)\nattach.bugs(leuk.fit)\n\n\n\n## Plot mean survival curves from the Exp model\ntime <- seq(0,170,1)\nsurvcurves1 <- exp(-theta1%*%t(time))\nsurvmean1 <- apply(survcurves1,2,mean)\nsurvcurves2 <- exp(-theta2%*%t(time))\nsurvmean2 <- apply(survcurves2,2,mean)\nplot(time,survmean1, type=\"l\", xlab=\"\", ylab=\"\", lwd=3)\nlines(time, survmean2, lty=2, lwd=3)\nlegend(\"topright\", c(\"AG Positive\",\"AG Negative\"), lty=1:2, lwd=2, cex=1,bty=\"n\")\nmtext(\"t\",line=3,side=1,cex=1.5)\nmtext(\"S(t)\",line=2.5,side=2,cex=1.5)\n\n\n## Frequentist Cox analysis of leukemia data\nn <- 33\ny <- c(65,156,100,134,16,108,121,4,39,143,56,26,22,1,1,5,65,56,65,17,7,16,22,3,4,2,3,8,4,3,30,4,43)\ng <- c(rep(1,17),rep(0,16))\nstatus <- rep(1,33)\ncox <- coxph(Surv(y, status) ~ g)\ncox.zph(cox)\nsummary(cox)\nagpos <- survfit(cox,list(g=1))\nagneg <- survfit(cox,list(g=0))\nplot(agpos$time, agpos$surv, type=\"l\")\nlines(agneg$time, agneg$surv,lty=1)\n\n\n\n\n## Plot estimated (mean) survival curves from (i) Bayes Exp model, (ii) Bayes PH model, and (iii) Freq PH model\n## FIGURE 13.5\n\ntimecox <- c(0,1,2,3,4,5,7,8,16,17,22,26,30,39,43,56,65,100,108,121,134,143,156)  \n\n# Estimates from WinBUGS code \nbayesagneg <- c(0.995,0.905,0.8615,0.7319,0.5623,0.5219,0.4829,0.4422,0.3694,0.3311,0.2617,0.2294,0.1979,0.1692,0.1409,0.09246,0.03141,0.02115,\n              0.01319,0.007724,0.004056,0.001636,3.62E-04)\n\nbayesagpos <-  c(0.9985,0.9713,0.9575,0.9133,0.8465,0.8285,0.8102,0.79,0.7501,0.7268,0.6788,0.6533,0.6255,0.5972,0.5652,0.4966,0.3377,0.288,\n                 0.2346,0.1828,0.1321,0.07805,0.02725)\n\n# Figure 13.4\nplot(time,survmean1, type=\"l\", xlab=\"\", ylab=\"\", lwd=2)\nlines(time, survmean2, lty=1, lwd=2)\nlines(timecox,bayesagpos,lty=2,lwd=2)\nlines(timecox,bayesagneg,lty=2,lwd=2)\nlines(agneg$time, agneg$surv,lty=1)\nlines(agpos$time, agpos$surv,lty=1)\nmtext(\"t\",line=3,side=1,cex=1.2)\nmtext(\"S(t)\",line=2.5,side=2,cex=1.2)\nlegend(\"topright\",lty=c(1,1,2), c(\"Bayes Exponential\",\"PH Frequentist\",\"PH Bayes\"),lwd=c(2,1,2))\ntext(125,0.3,\"AG+\")\ntext(17,0.2,\"AG-\")\n\n\n\n\n\n\n\n\n####  Figure 13.5. Leukemia data.  Using output from SAS\nbetapostmean <- -1.32\nhoAGneg <- c(0,0.088,0.2818,0.0537,0.0315,0.0504,0.029,0.037,0.0749,0.0571,0.2481,0.2481)\nhoAGpos <- exp(betapostmean)*hoAGneg\ntimeho <- c(0,0,3.5,4.5,7.5,16.5,24,41,60.6,82.5,127.5,160)\nplot(timeho,hoAGneg,type=\"s\",xlab=\"t\",ylab=\"Estimated Hazard\",cex=2)\nlines(timeho,hoAGpos,type=\"s\", lty=2)\nlegend(\"top\",lty=1:2,c(\"AG-\",\"AG+\"),bty=\"n\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "encoding": "ascii"}