{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/Ch5/RcodeDiasorinExample.txt", "content": "## Diasorin as a diagnostic test for low bone turnover in kidney dialysis patients\n## Comparing two means \n## Ch 5, Section 2 \n\n\nn1 <- 19\nn2 <- 15\nlow <- c(91, 46,  95,  60, 33, 410, 105, 43, 189,1097, 54,178, 114, 137, 233, 101, 25,70,357)\nnormal <- c(370, 267, 99,157, 75,1281, 48, 298, 268, 62,804,430,171,694,404)\ndiasorin <- c(low,normal)\ngroup <- c(rep(1,n1),rep(2,n2))\n\n\n####################################\n#     Normality. Fig 5.2           #\n####################################\n\ngroup1 <- factor(group, 1:2, c('Low','Normal')) \n\npar(mfrow=c(2,2), pty=\"s\")\nboxplot(diasorin~group1,range=0, ylab=\"Diasorin\", lwd=1.5)\nboxplot(log(diasorin)~group1,range=0, ylab=\"log(Diasorin)\", lwd=1.5)\n\nqqnorm(log(diasorin[group==1]),main = \"Low Group \\n Log transformed data\", lwd=2)\nqqline(log(diasorin[group==1]), lwd=2)\n\nqqnorm(log(diasorin[group==2]),main = \"Normal Group \\n Log transformed data\", lwd=2)\nqqline(log(diasorin[group==2]), lwd=2)\n\n\n\n\n\n\n####################################\n#     Descriptive Statistics       #\n####################################\n\nlibrary(Hmisc)\ng1 <- function(x)c(MEAN=mean(x,na.rm=TRUE),SD=sd(x,na.rm=TRUE),MEDIAN=median(x,na.rm=TRUE),MIN=min(x,na.rm=TRUE),MAX=max(x,na.rm=TRUE),N=length(x))\nsummarize(log(diasorin),by=group1,FUN=g1)\n\n\t\t\t\tLow\t\t\tNormal\nLog(Diasorin)                                                                                                               \t               \n  N\t\t\t  \t19\t\t\t15\t\t     \n  Mean (SD)\t\t  \t4.71 (0.94)\t\t5.49 (0.97)\t     \n  Median (Min, Max)    \t        4.62 (3.22, 7.00)   \t5.59 (3.87, 7.16)\t\n\n\n\n\n\n\n\n############################################################\n# Example 5.2.2.                                           #\n# Use R2WinBUGS for the 2 sample log normal Diasorin data  #\n############################################################\n\nlibrary(R2WinBUGS)\n\nn1 <- 19\nn2 <- 15\nlow <- c(91, 46,  95,  60, 33, 410, 105, 43, 189,1097, 54,178, 114, 137, 233, 101, 25,70,357)\nnormal <- c(370, 267, 99,157, 75,1281, 48, 298, 268, 62,804,430,171,694,404)\ndiasorindata <- list(\"n1\",\"n2\",\"low\",\"normal\")\nparameters <- c(\"muL\",\"muN\",\"tauL\",\"tauN\",\"medianL\",\"medianN\",\"relmedian\", \"test\", \"lowf\", \"normalf\",\"relprec\") \ninits <- list( list(muL=4.87, muN=5.39, tauL=1, tauN=1, lowf=50, normalf=50))\ndiasorin.fit <- bugs(diasorindata, inits, parameters,\"DiasorinModel.txt\", \n                 working.directory = \"F:\\\\MyDocuments\\\\BAYES\\\\OneandTwoSample\\\\Code\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\n\n\nparameters1 <- c(\"muL1\",\"muN1\",\"tauL1\",\"tauN1\",\"medianL1\",\"medianN1\",\"relmedian1\", \"test1\", \"lowf1\", \"normalf1\") \ninits1 <- list( list(muL1=4.87, muN1=5.39, tauL1=1, tauN1=1, lowf1=50, normalf1=50))\ndiasorin.fit1 <- bugs(diasorindata, inits1, parameters1,\"DiasorinModel1.txt\", \n                 working.directory = \"F:\\\\MyDocuments\\\\BAYES\\\\OneandTwoSample\\\\Code\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\n\n\nprint(diasorin.fit,digits=3)\nattach.bugs(diasorin.fit)\n\nround(print(diasorin.fit1),3)\nattach.bugs(diasorin.fit1)\n\n\n\n### Figure 5.4. Predictive distributions on the log scale for the low and normal groups\nattach.bugs(diasorin.fit)\nplot(density(log(lowf),n=1500), type='l', xlab=\"\", main=\"\", ylab=\"\", xlim=c(2,8), ylim=c(0,0.5), lwd=5)\nlines(density(log(normalf),n=1500),lty=2,lwd=5)\nmtext(\"log (Diasorin Score)\",line=3,side=1,cex=1.5)\nmtext(\"Predictive Density\",line=2.5,side=2,cex=1.5)\ntext(3.2,0.3,\"Low\",lwd=2,cex=1.2)\ntext(7,.3,\"Normal\",lwd=2,cex=1.2)\n\n### Figure 5.5.  Predictive distributions for the low and normal groups\nattach.bugs(diasorin.fit)  ## Fully informative priors\nplot(density(lowf,n=2500,from=0), type='l', xlab=\"\", main=\"\", ylab=\"\", xlim=c(0,1000), ylim=c(0,0.006), lwd=5)\nlines(density(normalf,n=2500,from=0),lty=2,lwd=5)\nlines(c(0,0),c(0,0.000593),lwd=5,lty=1)\nmtext(\"Diasorin Score\",line=3,side=1,cex=1.5)\nmtext(\"Predictive Density\",line=2.5,side=2,cex=1.5)\ntext(50,0.0055,\"Low\",lwd=2,cex=1.2)\ntext(380,0.0018,\"Normal\",lwd=2,cex=1.2)\n\n\n\nattach.bugs(diasorin.fit1)  ## Priors centered at elicited values, but otherwise fat.  \nplot(density(lowf1,n=2500), type='l', xlab=\"\", main=\"\", ylab=\"\", xlim=c(0,600), ylim=c(0,0.006), lwd=5)\nlines(density(normalf1,n=2500),lty=2,lwd=5)\nmtext(\"Diasorin Score\",line=3,side=1,cex=1.5)\nmtext(\"Predictive Density\",line=2.5,side=2,cex=1.5)\ntext(50,0.0055,\"Low\",lwd=2,cex=1.2)\ntext(350,0.0018,\"Normal\",lwd=2,cex=1.2)\n\n\n\n\nc(mean(log(lowf)), sd(log(lowf)))\nc(mean(log(normalf)), sd(log(normalf)))\n\n\nMean and SD of the predictive densities for low and normal \n\nLow:  mean=4.85    sd=0.93\n\nNormal:  mean= 5.39    sd=0.93\n\n\n\n\n\nSElow <- sd(low)/sqrt(n1)\nSEnormal <- sd(normal)/sqrt(n2)\nSElow\nSEnormal\n\nSEloglow <- sd(log(low))/sqrt(n1)\nSElognormal <- sd(log(normal))/sqrt(n2)\nSEloglow\nSElognormal\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "encoding": "ascii"}