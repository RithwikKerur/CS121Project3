{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/Ch9/Ch9RcodeANOVA.txt", "content": "#***************************************************************#\n# R code for the ANOVA example in Section 9.5.                  #\n# Diasorin data\t\t\t\t\t\t\t#\n# Adam Branscum                                                 #\n# 5-12-2009                                                     #\n#***************************************************************#\n\n\n\n\n\n\n##### DATA\nlow = c(91, 46,  95,  60, 33, 410, 105, 43, 189,1097, 54,178, 114, 137, 233, 101, 25,70,357)\nnormal = c(370, 267, 99,157, 75,1281, 48, 298, 268, 62,804,430,171,694,404)\nhigh = c(75,   52, 1378,  555,  331,  231,  472,  263,  120,   46,  650,  349,  251,  492,  759,\n                96,  627,  171, 1584,   69,  368,  509,  486,  354,  351,  839,   88,  162, 1041,  383,\n                234, 1130,  503,  244,  606,  457,  460,  283,  767,  576,  628,  239,  583,  428,  452,\n                723,  201,  406,  422,  243)\nDiasorin <- c(low,normal,high)\nlogD <- log(Diasorin)\nloghigh = log(high)\nloglow = log(low)\nlognormal = log(normal)\n\n\n\n\n\n##### LIBRARIES\nlibrary(nortest)\n\n\n\n\n\n\n##### ANALYSIS\ng1 <- c(rep(1,length(low)),rep(2,length(normal)),rep(3,length(high)))\ng <- factor(g1, 1:3, c(\"Low\",\"Normal\",\"High\"))\n\n\n## Boxplots and qq plot from least squares fit to ANOVA\npar(mfrow=c(1,2),pty=\"s\")\n\nboxplot(logD~g,range=0, ylab=\"Diasorin Score\",lwd=1.5)\n\n\n## Test for equal variance\nbartlett.test(logD,g) \n\n\n## ANOVA\nfit <- aov(logD~g)\nsummary(fit)\n\nqqnorm(resid(fit), main=\"Residuals from ANOVA \\n Anderson-Darling P=0.22\")\nqqline(resid(fit))\n\nad.test(resid(fit))   \n\n\n\n\n\n\n## Section 9.5.1.1. Allocation and Diagnosis\nlibrary(R2WinBUGS)\n\nn1 <- 19\nn2 <- 15\nn3 <- 50\nx <- c(50,150,250,350,450,550,650,750,850,950,1050)\npiL <- 0.40\npiN <- 0.20\npiH <- 0.40\ndiasorinanovadata <- list(\"n1\",\"n2\",\"n3\",\"low\",\"normal\",\"high\",\"x\",\"piL\",\"piN\",\"piH\")\nparameters <- c(\"mu1\",\"mu2\",\"mu3\",\"tau\",\"med1\",\"med2\",\"med3\",\"relmed21\",\"relmed31\",\"relmed32\",\"MAD\",\"prob\", \"lowf\",                                 \"normalf\",\"highf\",\"P\",\"diff21\",\"diff31\",\"diff32\",\"prob21\",\"prob32\",\"pL\",\"pN\",\"pH\") \ninits <- list( list(mu1=4.87, mu2=5.39, mu3=6.4, tau=1, lowf=50, normalf=50, highf=50))\ndiasorinfit <- bugs(diasorinanovadata, inits, parameters,\"DiasorinANOVAModel.txt\", \n                 working.directory = \"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=105000, n.thin=1, n.burnin=5000)\nprint(diasorinfit,digits=3)\nattach.bugs(diasorinfit)\n\n\n\n\n### Figure 9.2.  Predictive distributions on the log scale for the low, normal, and high groups\nplot(density(log(lowf),n=1500), type='l', xlab=\"\", main=\"\", ylab=\"\", xlim=c(1,10), ylim=c(0,0.5), lwd=3)\nlines(density(log(normalf),n=1500),lty=2,lwd=3)\nlines(density(log(highf),n=1500),lty=3,lwd=3)\nmtext(\"log (Diasorin Score)\",line=3,side=1,cex=1.2)\nmtext(\"Predictive Density\",line=2.5,side=2,cex=1.2)\nlegend(\"topleft\",c(\"Low\",\"Normal\",\"High\"),lty=1:3,lwd=c(2,2,2))\n\ng1 <- apply(pL,2,mean)\ng2 <- apply(pN,2,mean)\ng3 <- apply(pH,2,mean)\n\n\n### Figure 9.3.  Plot classification probabilities (posterior means) versus log diasorin score for the low, normal, and high groups\nplot(log(x),g1, type='l', xlab=\"\", main=\"\", ylab=\"\", xlim=c(3,7.5), ylim=c(0,1), lwd=3)\nlines(log(x),g2,lty=2,lwd=3)\nlines(log(x),g3,lty=3,lwd=3)\nmtext(\"log (Diasorin Score)\",line=3,side=1,cex=1.2)\nmtext(\"Probability\",line=2.5,side=2,cex=1.2)\nlegend(\"topleft\",c(\"Low\",\"Normal\",\"High\"),lty=1:3,lwd=c(2,2,2))\n\n\n\n\n\n\n\n\n\n", "encoding": "ascii"}