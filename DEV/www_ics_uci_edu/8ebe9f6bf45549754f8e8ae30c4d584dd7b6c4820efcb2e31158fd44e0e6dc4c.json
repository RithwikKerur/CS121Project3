{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/Ch8/Ch8Rcode.txt", "content": "# R code for chapter 8\n\n\n\n############ Trauma data\ntraumadata <- read.table(file=\"F:\\\\MyDocuments\\\\BAYES\\\\LogisticRegression\\\\TraumaData\\\\trauma300.txt\",header=T,sep=\"\\t\")\nattach(traumadata)\ntraumadata\n\n## Original variables\n#  ID  death   ISS    TI    RTS  AGE \n##\n\n\n\n# Boxplots.  Figure 8.1\npar(mfrow=c(2,2))\n\ng=factor(death,c(0,1),c(\"DIE\",\"LIVE\"))\nboxplot(ISS~g,range=0,boxwex=0.5,ylab=\"ISS\",xlab=\"\")\nlines(rep(1.32,length(ISS[death==0])),ISS[death==0],type=\"p\")\nlines(rep(2.32,length(ISS[death==1])),ISS[death==1],type=\"p\")\n\nboxplot(RTS~g,range=0,boxwex=0.5,ylab=\"RTS\",xlab=\"\", ylim=c(0,10))\nlines(rep(1.32,length(RTS[death==0])),RTS[death==0],type=\"p\")\nlines(rep(2.32,length(RTS[death==1])),RTS[death==1],type=\"p\")\n\nboxplot(AGE~g,range=0,boxwex=0.5,ylab=\"AGE\",xlab=\"\")\nlines(rep(1.32,length(AGE[death==0])),AGE[death==0],type=\"p\")\nlines(rep(2.32,length(AGE[death==1])),AGE[death==1],type=\"p\")\n\nx <- c(sum(TI[death==1]==0),sum(TI[death==1]==1),  sum(TI[death==0]==0),sum(TI[death==0]==1)) \nnames(x) <- c(\"TI=0\",\"TI=1\",\"TI=0\",\"TI=1\")\nbarplot(x, ylim=c(0,250), space=c(0,0,0.5,0))\nlines(c(0,4.5),c(0,0),lty=1)\nmtext(\"DIE\", side=1,at=1,line=2.5)\nmtext(\"LIVE\", side=1, at=3.5,line=2.5)\n\n\n\n\n## Plot posterior means of log(odds) for two groups.  \n## Figure 8.2 \nlordata <- read.table(file=\"F:\\\\MyDocuments\\\\BAYES\\\\LogisticRegression\\\\TraumaData\\\\logoddsdata.txt\",header=T,sep=\"\\t\")\nattach(lordata)\nlordata\n\nplot(Age, g1, xlab=\"Age\", ylab=\"log(Odds)\", type=\"l\", lwd=2)\nlines(Age, g2, lty=2, lwd=2)\nlegend(\"bottomright\",c(\"Blunt\",\"Penetrating\"), lty=1:2, bty=\"n\")\nlegend(\"topleft\",c(\"RTS=3.34\",\"ISS=40\"), bty=\"n\")\n\n\n\n\n\n## Plot prior and posterior of beta2 using std covariate\n## Figure 8.6\n\npost <- read.table(file=\"F:\\\\MyDocuments\\\\BAYES\\\\LogisticRegression\\\\Oring\\\\posterioriterates.txt\",header=T,sep=\"\\t\")\nattach(post)\npost\n\nprior <- read.table(file=\"F:\\\\MyDocuments\\\\BAYES\\\\LogisticRegression\\\\Oring\\\\prioriterates.txt\",header=T,sep=\"\\t\")\nattach(prior)\nprior\n\nbeta2post <- posterior[20001:40000]\nbeta2prior <- priorits[20001:40000]\nplot(density(beta2post),type='l',xlab=expression(beta[2]), ylab=\"Density\", xlim=c(-3.5,2.5), lwd=2, main=\"\")\nlines(density(beta2prior),lty=2,lwd=2)\nlegend(\"topright\", c(\"Posterior\",\"Prior\"),lty=c(1,2))   \n\n\n\n\n\n\n## Plot posterior means of log(odds) for several groups.  \n## Figure 8.7\nlordata1 <- read.table(file=\"F:\\\\MyDocuments\\\\BAYES\\\\LogisticRegression\\\\TraumaData\\\\logoddstrauma.txt\",header=T,sep=\"\\t\")\nattach(lordata1)\nlordata1\n\npar(mfrow=c(2,2))\n\nplot(C2, abl, xlab=\"ISS\", ylab=\"log(Odds)\", type=\"l\", lwd=2, ylim=c(-5,5))\nlines(C2,apen, lty=2, lwd=2)\nlegend(\"bottomright\",c(\"Blunt\",\"Penetrating\"), lty=1:2, bty=\"n\")\nlegend(\"topleft\",c(\"RTS=3.34\",\"AGE=60\"), bty=\"n\")\n\nplot(C2, bbl, xlab=\"ISS\", ylab=\"log(Odds)\", type=\"l\", lwd=2, ylim=c(-5,5))\nlines(C2,bpen, lty=2, lwd=2)\nlegend(\"bottomright\",c(\"Blunt\",\"Penetrating\"), lty=1:2, bty=\"n\")\nlegend(\"topleft\",c(\"RTS=3.34\",\"AGE=10\"), bty=\"n\")\n\nplot(C2, cbl, xlab=\"ISS\", ylab=\"log(Odds)\", type=\"l\", lwd=2, ylim=c(-5,5))\nlines(C2,cpen, lty=2, lwd=2)\nlegend(\"bottomright\",c(\"Blunt\",\"Penetrating\"), lty=1:2, bty=\"n\")\nlegend(\"topleft\",c(\"RTS=5.74\",\"AGE=60\"), bty=\"n\")\n\nplot(C2, dbl, xlab=\"ISS\", ylab=\"log(Odds)\", type=\"l\", lwd=2, ylim=c(-5,5))\nlines(C2,dpen, lty=2, lwd=2)\nlegend(\"bottomright\",c(\"Blunt\",\"Penetrating\"), lty=1:2, bty=\"n\")\nlegend(\"topleft\",c(\"RTS=5.74\",\"AGE=10\"), bty=\"n\")\n\n\n\n\n\n\n\n\n\n## Ztilde and its inverse\n## Section 8.4:  Trauma data\nXtilde <- c(1,25,7.84,60,0,0,\n            1,25,3.34,10,0,0,\n            1,41,3.34,60,1,60,\n            1,41,7.84,10,1,10,\n            1,33,5.74,35,0,0,\n            1,33,5.74,35,1,35)\nXtilde <- matrix(Xtilde, nrow=6, ncol=6, byrow=TRUE)\nXtinv <- solve(Xtilde)\nm.iss <- mean(ISS)\nsd.iss <- sd(ISS)\nm.rts <- mean(RTS)\nsd.rts <- sd(RTS)\nm.age <- mean(AGE)\nsd.age <- sd(AGE)\nZtilde <- matrix(0,6,6)\nZtilde[,1] = Xtilde[,1]\nZtilde[,2] = (Xtilde[,2] - m.iss)/sd.iss # ISS mean 14.28 sd 10.98\nZtilde[,3] = (Xtilde[,3] - m.rts)/sd.rts # RTS mean 7.287 sd 1.25\nZtilde[,4] = (Xtilde[,4] - m.age)/sd.age # AGE mean 31.4 sd 17.06\nZtilde[,5] = Xtilde[,5]  # TI 0/1 variate\nZtilde[,6] = Ztilde[,4]*Ztilde[,5] # Interaction\nZtinv <- solve(Ztilde)\nround(Ztinv,3)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "encoding": "ascii"}