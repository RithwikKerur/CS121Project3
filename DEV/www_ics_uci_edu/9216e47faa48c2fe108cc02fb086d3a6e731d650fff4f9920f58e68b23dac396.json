{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/Ch9/Ch9Rcode.txt", "content": "#************************#\n# R code for chapter 9   #\n# Adam Branscum          #\n# 1-22-2009              #\n#************************#\n\n\n\n############ Bank salary data\n\n\nBankdata <- read.table(file=\"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\\\\BankSalaryData.txt\",header=T, sep=\"\")\nattach(Bankdata)\noptions(contrasts=c(\"contr.treatment\",\"contr.poly\"))\nBankdata\n\n# Figure 9.1. Scaterplot matrix\npairs(~BegSal+Educ+Exper+Time,labels=c(\"Beginning Salary\",\"Education\",\"Experience\",\"Time\"),data=Bankdata)\n\nmale <- Sex-1  # Sex 1=female; 2=male\nn <- length(BegSal)\nr <- 5\nfit <- lm(BegSal~Educ+Exper+Time+male)\nsummary(fit)\nSSE <- t(BegSal-fit$fitted.values)%*%(BegSal-fit$fitted.values)\nMSE <- SSE/(n-r)\ntauhat <- 1/MSE\nsdtau <- tauhat*sqrt(2/(n-r))\nnew <- data.frame(Educ=16, Exper=54.5, Time=33, male=1)\npredict.lm(fit, newdata=new,interval=\"confidence\",se.fit=T)\npredict.lm(fit, newdata=new,interval=\"prediction\",se.fit=T)\na <- qchisq(0.025,88)\nb <- qchisq(0.975,88)\na/SSE\nb/SSE\nsqrt(SSE/b)\nsqrt(SSE/a)\n\n\n\n############ FEV data\n\nFEVdata <- read.table(file=\"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\\\\FEVdataAge10to19.txt\",header=T, sep=\"\\t\")\nattach(FEVdata)\noptions(contrasts=c(\"contr.treatment\",\"contr.poly\"))\n\nlibrary(R2WinBUGS)\nYtilde <- c(2.8,3,4,3.3)\nD <- diag(c(.04,.04,.04,.09))\nXtilde <- matrix(c(1,11,0,0,\n                   1,13,1,13,\n                   1,16,0,0,\n                   1,18,1,18),4,4,byrow=T)\nXtildeinv <- solve(Xtilde)\nbeta0 <- c(t(Xtildeinv %*% Ytilde))\nC0 <- Xtildeinv %*% D %*% t(Xtildeinv)\nC0inv <- solve(C0)\na <- 1.73\nb <- 0.78\nn <- length(FEV)\nr <-  dim(Xtildeinv)[1]\nFEVdataBUGS <- list(\"n\",\"r\",\"beta0\",\"C0inv\",\"a\",\"b\",\"FEV\",\"Age\",\"Smoke\")\nparameters <- c(\"beta\",\"tau\",\"meanFEVs\",\"meanFEVns\",\"RM\",\"MD\",\"FEV20s\",\"FEV20ns\") \ninits <- list(list(tau=1,beta=c(0,0,0,0),FEV20s=2, FEV20ns=2))\nFEV.fit <- bugs(FEVdataBUGS, inits, parameters,\"FEVWBModel.txt\", \n                 working.directory = \"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\nprint(FEV.fit,digits=3)\nattach.bugs(FEV.fit)\n\n\n\n\n\n\n# Code for proper reference prior\nlibrary(R2WinBUGS)\nXtilde <- matrix(c(1,11,0,0,\n                   1,13,1,13,\n                   1,16,0,0,\n                   1,18,1,18),4,4,byrow=T)\nXtildeinv <- solve(Xtilde)\nr <-  dim(Xtildeinv)[1]\nbeta0 <- rep(0,r)\nc1 <- 0.001\nC0inv <- diag(rep(c1,r))\na <- 0.001\nb <- 0.001\nn <- length(FEV)\n\nFEVdataBUGS <- list(\"n\",\"r\",\"beta0\",\"C0inv\",\"a\",\"b\",\"FEV\",\"Age\",\"Smoke\")\nparameters <- c(\"beta\",\"tau\",\"meanFEVs\",\"meanFEVns\",\"RM\",\"MD\",\"FEV20s\",\"FEV20ns\") \ninits <- list(list(tau=1,beta=c(0,0,0,0),FEV20s=2, FEV20ns=2))\nFEV.fit1 <- bugs(FEVdataBUGS, inits, parameters,\"FEVWBModel.txt\", \n                 working.directory = \"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\nprint(FEV.fit1,digits=3)\nattach.bugs(FEV.fit1)\n\n\n\n\n\n\n\n\n\n\n## Plot of Bayesian posterior means from a linear regression with interaction term and BCJ prior for the FEV data\n\nBayesSmoker <- FEV.fit$mean$meanFEVs\nBayesNonsmoker <- FEV.fit$mean$meanFEVns\nAge1 <- seq(10,19,1)\nplot(Age,FEV,xlab=\"Age\", ylab=\"FEV\", lwd=1.5)\nlines(Age1,BayesSmoker,type='l', lty=1, lwd=2,cex=1.2)\nlines(Age1,BayesNonsmoker,type='l', lty=2, lwd=2,cex=1.2)\nlegend(\"bottomright\", c(\"Smoker\", \"Nonsmoker\"), lty=c(1,2), lwd=2)\n\n\n\n\n\n\n\n## Compute CPO statistics and LPML.  Could have put the appropriate lines in the code above.\n\nlibrary(R2WinBUGS)\nmtilde0 <- c(2.8,3,4,3.3)\ncov0 <- diag(c(.04,.04,.04,.09))\nprec0 <- solve(cov0)\nXtilde <- matrix(c(1,11,0,0,\n                   1,13,1,13,\n                   1,16,0,0,\n                   1,18,1,18),4,4,byrow=T)\nXtildeinv <- solve(Xtilde)\nbetastar <- c(t(Xtildeinv%*%mtilde0))\nC0 <- Xtildeinv %*% cov0 %*% t(Xtildeinv)\nC0inv <- solve(C0)\na <- 1.73\nb <- 0.78\nn <- length(FEV)\nr <-  dim(Xtildeinv)[1]\nFEVdataBUGS <- list(\"n\",\"r\",\"betastar\",\"C0inv\",\"a\",\"b\",\"FEV\",\"Age\",\"Smoke\")\nparameters <- c(\"beta\",\"tau\",\"CPOinv\") \ninits <- list(list(tau=1,beta=c(0,0,0,0)))\nFEV.fit <- bugs(FEVdataBUGS, inits, parameters,\"FEVWBModel1.txt\", \n                 working.directory = \"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=12000, n.thin=1, n.burnin=2000)\nprint(FEV.fit,digits=3)\nattach.bugs(FEV.fit)\nCPO <- 1/FEV.fit$mean$CPOinv\nLPML <- sum(log(CPO))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#### CODA for convergence diagnostics (not in book)\n\nmtilde0 <- c(2.8,3,4,3.3)\ncov0 <- diag(c(.04,.04,.04,.09))\nprec0 <- solve(cov0)\nXtilde <- matrix(c(1,11,0,0,\n                   1,13,1,13,\n                   1,16,0,0,\n                   1,18,1,18),4,4,byrow=T)\nXtildeinv <- solve(Xtilde)\nbetastar <- c(t(Xtildeinv%*%mtilde0))\nC0 <- Xtildeinv %*% cov0 %*% t(Xtildeinv)\nC0inv <- solve(C0)\na <- 1.73\nb <- 0.78\nn <- length(FEV)\nr <-  dim(Xtildeinv)[1]\nFEVdataBUGS <- list(\"n\",\"r\",\"betastar\",\"C0inv\",\"a\",\"b\",\"FEV\",\"Age\",\"Smoke\")\nparameters <- c(\"beta\",\"tau\") \ninits <- list(list(tau=1,  beta=c(0,0,0,0),FEV20s=2, FEV20ns=2),\n              list(tau=.1, beta=c(10,10,10,10)),\n              list(tau=5,  beta=c(-10,-10,-10,-10)),\n              list(tau=10, beta=c(10,-10,10,-10)),\n              list(tau=15, beta=c(-10,10,-10,10)),\n              list(tau=20, beta=c(10,-10,0,0)),\n              list(tau=.5, beta=c(0,0,5,-10)),\n              list(tau=1,  beta=c(5,5,-10,0)))\nFEV.fit <- bugs(FEVdataBUGS, inits, parameters,\"FEVWBModel.txt\", codaPkg=TRUE,\n                 working.directory = \"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=8, n.iter=12000, n.thin=1, n.burnin=2000)\nattach.bugs(FEV.fit)\n\nsetwd(\"H:/MyDocuments/BAYES/LinearRegression/CodeandData\")\nlibrary(coda)\ncodamenu()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n######## Section 9.6.  Model diagnostics\n\nn <- length(FEV)\nLR <- lm(FEV~Age+Smoke+Age:Smoke)\nsummary(LR)\nbeta <- coef(LR)\nX <- cbind(rep(1,n),Age,Smoke,Age*Smoke)\nrstudsmoke <- rstudent(LR)[Smoke==1]\nrstudnonsmoke <- rstudent(LR)[Smoke==0]\n\npar(mfrow=c(2,2))\nplot(fitted(LR),resid(LR),xlab=\"Fitted Values\", ylab=\"Residuals\",main=\"\")\nlines(lowess(fitted(LR),resid(LR)))\nqqnorm(resid(LR),main=\"\")\nqqline(resid(LR))\n#hist(rstudent(LR),xlab=\"Residuals\",main=\"\")\n\n### Figure 9.4\npar(mfrow=c(2,2))\nplot(fitted(LR)[Smoke==0],rstudnonsmoke,xlab=\"Fitted Values\", ylab=\"Studentized Residuals\",main=\"Nonsmokers \\n Residual Plot\")\nlines(lowess(fitted(LR)[Smoke==0],rstudnonsmoke))\nqqnorm(rstudnonsmoke,main=\"Nonsmokers \\n Normal Plot\")\nqqline(rstudnonsmoke)\n\nplot(fitted(LR)[Smoke==1],rstudsmoke,xlab=\"Fitted Values\", ylab=\"Studentized Residuals\",main=\"Smokers \\n Residual Plot\")\nlines(lowess(fitted(LR)[Smoke==1],rstudsmoke))\nqqnorm(rstudsmoke,main=\"Smokers \\n Normal Plot\")\nqqline(rstudsmoke)\n\n\n\n\n## Plot of studentized residuals versus age\nplot(Age, rstudent(LR),xlab=\"Age\", ylab=\"Residuals\",main=\"\")\nlines(lowess(Age,rstudent(LR)))\n\n\n\n## Quadratic trend in age\nAge2 <- Age^2\nLR1 <- lm(FEV~ Age + Age2 + Smoke + Age:Smoke + Age2:Smoke)\nsummary(LR1)\nrstudsmoke1 <- rstudent(LR1)[Smoke==1]\nrstudnonsmoke1 <- rstudent(LR1)[Smoke==0]\n\n### Figure 9.5\npar(mfrow=c(1,2))\nplot(fitted(LR1)[Smoke==0],rstudnonsmoke1,xlab=\"Fitted Values\", ylab=\"Studentized Residuals\",main=\"Nonsmokers \\n Residual Plot\")\nlines(lowess(fitted(LR1)[Smoke==0],rstudnonsmoke1))\n#qqnorm(rstudnonsmoke1,main=\"Nonsmokers \\n Normal Plot\")\n#qqline(rstudnonsmoke1)\n\nplot(fitted(LR1)[Smoke==1],rstudsmoke1,xlab=\"Fitted Values\", ylab=\"Studentized Residuals\",main=\"Smokers \\n Residual Plot\")\nlines(lowess(fitted(LR1)[Smoke==1],rstudsmoke1))\n#qqnorm(rstudsmoke1,main=\"Smokers \\n Normal Plot\")\n#qqline(rstudsmoke1)\n\n\n\n\n\n\n\n\n\n\n## Exercise 9.19.  Using the model for FEV with predictors A, A^2(1-S), S, SA.  This is model 6 from section 9.7. \nA2NS <- Age*Age*(1-Smoke)\nAS <- Age*Smoke\nbetahat <- c(-2.656, 0.733, -0.02, 5.046, -0.666)\nY <- FEV\nn <- length(Y)\np <- length(betahat)\nX <- matrix(c(rep(1,n),Age,A2NS,Smoke,AS),n,p)\nYhat <- X %*% betahat\nH <- X %*% solve(t(X) %*% X) %*% t(X)\nrr <- Y - Yhat\nHdiag <- diag(H)\nV <- diag(Hdiag)\nI <- diag(1, n, n)\nMSE <- c((t(Y-Yhat) %*% (Y-Yhat))/  (n-p))\nr <- (solve(sqrt(MSE*(I-V))) %*% rr)\nD <- V %*% solve(I-V) %*% diag(c(r)) %*% r \nmax(r)\nr==max(r)   # case 132.  max(r)=2.989.  person is 12 yo and has FEV that is 342 highest out 345 \nmax(D)\nD==max(D)   # case 1.  max(D)=0.71\n#cbind(r,D)\n\n\n\n\n\n\nm6 <- lm(FEV~Age+A2NS+Smoke+AS)\nrstudent(m6)\ncooks.distance(m6)\ncbind(r,rstudent(m6))   # These are a little different because R uses least squares and I used the posterior mean with proper\n                        # reference prior\ncbind(D,cooks.distance(m6))  ## Have to divide D by p to get the same formula of Cook's D used by R\n\n\n\n\n\n# Is case 132 data fit well by the model?  Answer. No\nR132 <- sqrt((n-p-1)*r[132]^2 / (n-p-r[132]^2))\nalpha <- 0.05\nabs(R132) > qt(1-alpha/2,n-p-1)\n\n\n# Calculate Ri for all i\nR <- sqrt((n-p-1)*r^2  / (n-p-r^2))\n\n\n# Calculate the observed Rf and show that it is equal to Ri for case 132\nm <- lm(FEV[-132]~Age[-132]+A2NS[-132]+Smoke[-132]+AS[-132])\nb <- c(-2.47453,  0.70366, -0.01881,  4.86902, -0.63722)   # Least squares estimate for beta:  remove case 132\nb <- c(-2.46,    0.7014,  -0.01873,  4.854,   -0.635)   # Posterior mean for beta:  remove case 132\nMSE1 <- sum((FEV[-132]-X[-132,] %*% b)^2)/(n-1-p)\nRf <- (FEV[132] - X[132,] %*% b)  / sqrt(MSE1 * (1 +  X[132,] %*% solve(t(X[-132,]) %*% X[-132,])  %*% X[132,]))\nR132  ## Close to equal to Rf\nRf\n\n\n\n\n\n\n\n\nPosterior mean for beta:  complete case analysis\n(-2.656, 0.733, -0.02, 5.046, -0.666)\n\nPosterior mean for beta:  remove case 1 (highest Cook's D at 0.71; next highest is 0.38); a 19 yo NS with high FEV (ranked 341 out of 345). \n(-3.501,0.8727,-0.02558,5.896,-0.8063)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n######## Section 9.7:  Model Selection \n\n# Calculate LPML and DIC\n\nn <- length(FEV)\nparameters <- c(\"beta\",\"tau\",\"CPOinv\") \n\n\n\n## Model 1: (Smoke); Diffuse priors\ninits <- list(list(tau=1,beta=c(0,0)))\nFEVdataBUGS <- list(\"n\",\"FEV\",\"Smoke\")\nFEV.fit1 <- bugs(FEVdataBUGS, inits, parameters,\"Model1.txt\", \n                 working.directory=\"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=12000, n.thin=1, n.burnin=2000)\nCPO1 <- 1/FEV.fit1$mean$CPOinv\nLPML1 <- sum(log(CPO1))\nprint(FEV.fit1,digits=3)\n\n\n\n## Model 2: (Age); Diffuse priors\ninits <- list(list(tau=1,beta=c(0,0)))\nFEVdataBUGS <- list(\"n\",\"FEV\",\"Age\")\nFEV.fit2 <- bugs(FEVdataBUGS, inits, parameters,\"Model2.txt\", \n                 working.directory=\"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=12000, n.thin=1, n.burnin=2000)\nCPO2 <- 1/FEV.fit2$mean$CPOinv\nLPML2 <- sum(log(CPO2))\nprint(FEV.fit2,digits=3)\n\n\n\n\n## Model 3: (Age,Smoke); Diffuse priors\ninits <- list(list(tau=1,beta=c(0,0,0)))\nFEVdataBUGS <- list(\"n\",\"FEV\",\"Age\",\"Smoke\")\nFEV.fit3 <- bugs(FEVdataBUGS, inits, parameters,\"Model3.txt\", \n                 working.directory=\"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=12000, n.thin=1, n.burnin=2000)\nCPO3 <- 1/FEV.fit3$mean$CPOinv\nLPML3 <- sum(log(CPO3))\nprint(FEV.fit3,digits=3)\n\n\n\n\n## Model 4: (Age,Smoke,Age*Smoke); Diffuse priors\ninits <- list(list(tau=1,beta=c(0,0,0,0)))\nFEVdataBUGS <- list(\"n\",\"FEV\",\"Age\",\"Smoke\")\nFEV.fit4 <- bugs(FEVdataBUGS, inits, parameters,\"Model4.txt\", \n                 working.directory=\"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=12000, n.thin=1, n.burnin=2000)\nCPO4 <- 1/FEV.fit4$mean$CPOinv\nLPML4 <- sum(log(CPO4))\nprint(FEV.fit4,digits=3)\n\n\n\n## Model 5: (Age,Age2,Smoke,Age*Smoke,Age2*Smoke); Diffuse priors\ninits <- list(list(tau=1,beta=c(0,0,0,0,0,0)))\nFEVdataBUGS <- list(\"n\",\"FEV\",\"Age\",\"Smoke\")\nFEV.fit5 <- bugs(FEVdataBUGS, inits, parameters,\"Model5.txt\", \n                 working.directory=\"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=12000, n.thin=1, n.burnin=2000)\nCPO5 <- 1/FEV.fit5$mean$CPOinv\nLPML5 <- sum(log(CPO5))\nprint(FEV.fit5,digits=3)\n\n\n\n\n## Model 6: (Age,Smoke,Age*Smoke,Age2*(1-Smoke)); Diffuse priors\ninits <- list(list(tau=1,beta=c(0,0,0,0,0)))\nFEVdataBUGS <- list(\"n\",\"FEV\",\"Age\",\"Smoke\")\nFEV.fit6 <- bugs(FEVdataBUGS, inits, parameters,\"Model6.txt\", \n                 working.directory=\"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\", \n                 n.chains=1, n.iter=12000, n.thin=1, n.burnin=2000)\nCPO6 <- 1/FEV.fit6$mean$CPOinv\nLPML6 <- sum(log(CPO6))\nprint(FEV.fit6,digits=3)\n\n\n\n\n## Bayes factors\nPBF21 <- exp(LPML2-LPML1)\nPBF31 <- exp(LPML3-LPML1)\nPBF41 <- exp(LPML4-LPML1)\nPBF51 <- exp(LPML5-LPML1)\nPBF61 <- exp(LPML6-LPML1)\n\nPBF32 <- exp(LPML3-LPML2)\nPBF42 <- exp(LPML4-LPML2)\nPBF52 <- exp(LPML5-LPML2)\nPBF62 <- exp(LPML6-LPML2)\n\nPBF43 <- exp(LPML4-LPML3)\nPBF53 <- exp(LPML5-LPML3)\nPBF63 <- exp(LPML6-LPML3)\n\nPBF54 <- exp(LPML5-LPML4)\nPBF64 <- exp(LPML6-LPML4)\n\nPBF65 <- exp(LPML6-LPML5)\n\nc(PBF21,PBF31,PBF41,PBF51,PBF61,PBF32,PBF42,PBF52,PBF62,PBF43,PBF53,PBF63,PBF54,PBF64,PBF65)\n\n\n\n\n\n\n\n\n## BIC statistics\n\nn <- length(FEV)\n\nm1 <- lm(FEV~Smoke)\nAIC(m1,k=2)\nAIC(m1,k=log(n))  #Gives BIC\nanova.lm(m1)\nsigma2 <- .57\ntau <- 1/sigma2\nr <- 2\nBIC1 <-  n*log(2*pi*sigma2) + (1/sigma2)*sum((FEV-(m1$coef[1]+m1$coef[2]*Smoke))^2)  + (r+1)*log(n)\nBIC1a <- -n*log(tau)+n*log(2*pi) + tau*sum((FEV-(m1$coef[1]+m1$coef[2]*Smoke))^2)  + (r+1)*log(n)\nBIC1\nBIC1a\n\n\nm2 <- lm(FEV~Age)\nAIC(m2,k=log(n))  #Gives BIC\n\n\nm3 <- lm(FEV~Age+Smoke)\nAIC(m3,k=log(n))  \n\n\nm4 <- lm(FEV~Age+Smoke+Age*Smoke)\nAIC(m4,k=log(n))  \nanova.lm(m4)\nsigma2 <- .441\nr <- 4\nBIC4 <- n*log(2*pi*sigma2) + (1/sigma2)*sum((FEV-(m4$coef[1]+m4$coef[2]*Age+m4$coef[3]*Smoke+m4$coef[4]*Age*Smoke))^2)  + (r+1)*log(n)\nBIC4\n\nAge2 <- Age^2\nAS <- Age*Smoke\nA2S <- Age*Age*Smoke\nA2NS <- Age*Age*(1-Smoke)\n\n\nm5 <- lm(FEV~Age+Age2+Smoke+AS+A2S)\nAIC(m5,k=log(n))  \n\n\n\nm6 <- lm(FEV~Age+A2NS+Smoke+AS)\nAIC(m6,k=log(n)) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#### Section 9.8:  Nonlinear regression\n\n# Dugong data\nx <- c(1.0,  1.5,  1.5,  1.5, 2.5,   4.0,  5.0,  5.0,  7.0,\n       8.0,  8.5,  9.0,  9.5, 9.5,  10.0, 12.0, 12.0, 13.0,\n      13.0, 14.5, 15.5, 15.5, 16.5, 17.0, 22.5, 29.0, 31.5)\nxstd <- (x-mean(x))/sd(x)\ny <- c(1.80, 1.85, 1.87, 1.77, 2.02, 2.27, 2.15, 2.26, 2.47,\n       2.19, 2.26, 2.40, 2.39, 2.41, 2.50, 2.32, 2.32, 2.43,\n       2.47, 2.56, 2.65, 2.47, 2.64, 2.56, 2.70, 2.72, 2.57)\ndugongdata <- data.frame(xstd,y)\nn <- 27\n\n\n## This function creates the vector mtilde (equation 3 in the Section 9.8)\nmt <- function(b1,b2,b3){\n  m <- matrix(c(b1-exp(b2),b1-exp(b2+b3),b1-exp(b2-b3)),3,1)\n  return(m)\n}\n\n## This function creates the matrix mtilde dot (equation 4 in Section 9.8)\nmtdot <- function(b2,b3){\n  mtd <- matrix(c(1,1,1,-exp(b2),-exp(b2+b3),-exp(b2-b3),0,-exp(b2+b3),exp(b2-b3)),3,3)\n  return(mtd)\n}\n\nXt <- matrix(c(1,1,1,0,1,-1),3,2)\nm0t <- c(2.4,2.6,2.0) \ndelta <- 0.001\n#b0old <- c(0,1,-1)\n#b0old <- c(2.65,-1.54,-1.08) # MLEs\nb0old <- c(10,10,-10)\n\nb0new <- b0old + solve(mtdot(b0old[2],b0old[3])) %*% (m0t-mt(b0old[1],b0old[2],b0old[3]))\n\nwhile(sum(abs(b0new-b0old))>delta){\n  b0old <- b0new\n  b0new <- b0old + solve(mtdot(b0old[2],b0old[3])) %*% (m0t-mt(b0old[1],b0old[2],b0old[3]))\n}\n\nb0new  # Answer is c(2.8000000, -0.9162907, -0.6931472)\n\n\n\nbeta0 <- c(2.8000000, -0.9162907, -0.6931472)\nD <- diag(c(25,25,25))\ncov0 <- solve(mtdot(beta0[2],beta0[3])) %*% D %*% t(solve(mtdot(beta0[2],beta0[3])))\nprec0 <- solve(cov0) \nxstar <- seq(-1.3,2.6,0.1)\nK <- length(xstar)\na <- 0.001\nb <- 0.001\n\n\nlibrary(R2WinBUGS)\n\nDugongDataBUGS <- list(\"n\",\"beta0\",\"prec0\",\"a\",\"b\",\"y\",\"xstd\",\"xstar\",\"K\")\nparameters <- c(\"beta\",\"tau\",\"thetastar\") \ninits <- list(list(tau=1,beta=c(0,0,0)))\nDugong.fit <- bugs(DugongDataBUGS, inits, parameters,\"DugongWBcode.txt\", \n                 working.directory = \"H:\\\\MyDocuments\\\\BAYES\\\\LinearRegression\\\\CodeandData\\\\NonlinearRegression\", \n                 n.chains=1, n.iter=60000, n.thin=1, n.burnin=10000)\nprint(Dugong.fit,digits=3)\nattach.bugs(Dugong.fit)\n\n\n## Figure 9.6.  Plot estimated growth curve. Posterior mean and 95% pointwise band for theta\n\nPostm <- Dugong.fit$mean$thetastar\nPostl <- apply(thetastar,2,quantile,0.025) \nPostu <- apply(thetastar,2,quantile,0.975) \nplot(xstd,y,xlab=\"Standardized Age\", ylab=\"Length\", lwd=2)\nlines(xstar,Postm,type='l', lty=1, lwd=2,cex=1.2)\nlines(xstar,Postl,lty=2,lwd=2)\nlines(xstar,Postu,lty=2,lwd=2)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "encoding": "ascii"}