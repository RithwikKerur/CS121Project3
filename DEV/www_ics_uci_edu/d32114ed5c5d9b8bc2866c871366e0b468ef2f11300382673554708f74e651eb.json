{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/Ch15/Chap15DPpackage.txt", "content": "##############################################################################\n# Density estimation examples\n# DPdensity fits univariate and multivariate versions of \n# the conjugate model of Escobar and West (1995).\n# PTdensity fits marginalized (Hanson and Johnson, 2002) and finite Polya\n# tree MPTs (Hanson, 2006) to univariate and multivariate data.  For \n# multivariate, only the marginalized version is fit.\n##############################################################################\n\nlibrary(DPpackage)\nhelp(DPdensity) # look at documentation\nhelp(PTdensity)\ndata(galaxy)\nhelp(galaxy)\nattach(galaxy)\nspeeds=galaxy/1000\n\n# MCMC specifications and prior for DP mixture\nmcmc=list(nburn=1000,nsave=2000,nskip=19,ndisplay=100)\nm=mean(speeds)\ns=var(speeds)\nprior=list(a0=1,b0=1,nu1=3,nu2=1,s2=s,m2=m,psiinv2=solve(0.1*s),tau1=0.2,tau2=2)\n\n# Fit DP mixture, plot, and obtain LPML\nfit.dpm=DPdensity(y=speeds,prior=prior,mcmc=mcmc,state=NULL,status=TRUE)\nsummary(fit.dpm)\nplot(fit.dpm)\nplot(fit.dpm,output=\"param\")\nsum(log(fit.dpm$cpo)) # LPML statistic\n\n# MCMC specifications and prior for MPT\nmcmc=list(nburn=1000,nsave=2000,nskip=19,ndisplay=100,tune1=0.15,tune2=1.1,tune3=1.1)\nprior=list(a0=5,b0=1,M=5)\n\n# Fit MPT, plot, and obtain LPML\nfit.mpt=PTdensity(y=speeds,prior=prior,mcmc=mcmc,state=state,status=TRUE)\nsummary(fit.mpt)\nplot(fit.mpt)\nplot(fit.mpt,output=\"param\")\nsum(log(fit.mpt$cpo)) # LPML statistic\n\n##############################################################################\n# Generalized additive model example: enthanol data.\n# pord=order of penalty prior, pord=1 gives random walk prior in Chapter 15.\n# degree=degree of B-spline basis functions, d=3 gives cubic.\n# beta0 and Sbeta0 are mean and covariance of fixed effects: intercept and\n# any other linear terms in the model.\n# Penalty *prior* is the same across additive transformations lambda_i ~ gamma(taub1,taub2).\n# For Gaussian responses, precision tau ~ gamma(tau1,tau2).\n##############################################################################\n\nlibrary(lattice)\ndata(ethanol)\nattach(ethanol)\nhelp(ethanol)\nplot(ethanol)\nhelp(PSgam)\n\n# Model with only transformed E ( included\nprior=list(taub1=0.01,taub2=0.01,beta0=rep(0,1),Sbeta0=diag(100,1),tau1=0.001,tau2=0.001)\nmcmc=list(nburn=2000,nsave=2000,nskip=9,ndisplay=100)\nfit1=PSgam(formula=ethanol$NOx~ps(ethanol$E,k=20,degree=3,pord=1),\n          family=gaussian(identity),prior=prior,mcmc=mcmc,ngrid=50,state=NULL,status=TRUE)\nplot(fit1)\nsum(log(fit1$cpo))\n\n# Additive model with additive E and C functions\nfit2=PSgam(formula=ethanol$NOx~ps(ethanol$E,ethanol$C,k=20,degree=3,pord=1),\n          family=gaussian(identity),prior=prior,mcmc=mcmc,ngrid=50,state=NULL,status=TRUE)\nplot(fit2)\nsum(log(fit2$cpo))\n\n# Model with transformed E but linear C\nprior=list(taub1=0.01,taub2=0.01,beta0=rep(0,2),Sbeta0=diag(100,2),tau1=0.001,tau2=0.001)\nfit3=PSgam(formula=ethanol$NOx~ps(ethanol$E,k=20,degree=3,pord=1)+ethanol$C,\n          family=gaussian(identity),prior=prior,mcmc=mcmc,ngrid=50,state=NULL,status=TRUE)\nplot(fit3)\nsummary(fit3)\nsum(log(fit3$cpo))\n\n# Model with transformed E but categorical C\nprior=list(taub1=0.01,taub2=0.01,beta0=rep(0,5),Sbeta0=diag(100,5),tau1=0.001,tau2=0.001)\nfit4=PSgam(formula=ethanol$NOx~ps(ethanol$E,k=20,degree=3,pord=1)+factor(ethanol$C),\n          family=gaussian(identity),prior=prior,mcmc=mcmc,ngrid=50,state=NULL,status=TRUE)\nplot(fit4)\nsummary(fit4)\nsum(log(fit4$cpo))\n\n##############################################################################\n# Generalized additive model example: O-Ring data of Table 8.1\n# B-spline seems to overfit unless one is careful.  \n# MCMC mixing can also be problematic.\n##############################################################################\n\nfailure=c(1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,0)\ntemp=c(53,57,58,63,66,67,67,67,68,69,70,70,70,70,72,73,75,75,76,76,78,79,81)\n\nmcmc=list(nburn=2000,nsave=2000,nskip=9,ndisplay=100,tune=1.1)\nprior=list(beta0=rep(0,2),Sbeta0=diag(1000,2))\nfit.logit=  Pbinary(failure~temp,link=\"logit\",  prior=prior,mcmc=mcmc,state=NULL,status=TRUE)\nfit.cloglog=Pbinary(failure~temp,link=\"cloglog\",prior=prior,mcmc=mcmc,state=NULL,status=TRUE)\nfit.probit= Pbinary(failure~temp,link=\"probit\", prior=prior,mcmc=mcmc,state=NULL,status=TRUE)\nsum(log(fit.logit$cpo))\nsum(log(fit.cloglog$cpo))\nsum(log(fit.probit$cpo))\n\nmcmc=list(nburn=5000,nsave=5000,nskip=19,ndisplay=100)\nprior=list(taub1=0.01,taub2=0.01,beta0=rep(0,1),Sbeta0=diag(1000,1))\nfit1.additive1=PSgam(formula=failure~ps(temp,k=20,degree=3,pord=1),\n          family=binomial(logit),prior=prior,mcmc=mcmc,ngrid=50,state=NULL,status=TRUE)\nsum(log(fit1.additive$cpo))\n\n\nprior=list(taub1=1,taub2=0.01,beta0=rep(0,1),Sbeta0=diag(1000,1))\nfit2.additive=PSgam(formula=failure~ps(temp,k=20,degree=3,pord=1),\n          family=binomial(logit),prior=prior,mcmc=mcmc,ngrid=50,state=NULL,status=TRUE)\nsum(log(fit2.additive$cpo))\n\nplot(fit1.additive)\nplot(fit2.additive)\n\n\n\n\n", "encoding": "ascii"}