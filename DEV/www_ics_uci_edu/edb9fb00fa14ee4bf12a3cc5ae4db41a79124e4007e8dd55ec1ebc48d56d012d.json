{"url": "https://www.ics.uci.edu/~wjohnson/BIDA/AppendixC/RcodeAppendix.txt", "content": "#***************************************************************#\n# R code for Appendix C, Getting Started in R                   #\n#***************************************************************#\n\n\n\n\n## SOME R BASICS\n\ny <- c(44,15,87,-4)\nx = c(pi,exp(1),sqrt(3),10^2)\n\n\nmean(x)\nmedian(x)\nvar(x)\nsd(x)\nrange(x)\nquantile(x,c(0.25,0.75))\nmin(x)\nmax(x)\nlength(x)\nsum(x)\n#rm(x) # this will remove x\n\n\n\n\n\nz <- c(rep(4,5),16,NA)\nz\nmean(z)\n\nmean(z,na.rm=TRUE)\n\n\n?mean\nhelp(mean)\n\n\n\n\nsqrt(x)\n\n\n\n\n\nx1 <- matrix(x,nrow=2,ncol=2)\nx1\ny1 <- matrix(y,2,2)\ny1\nt(x1)\nsolve(x1)\nx1%*%y1\n\n\n\n\nx1[2,1]\n\nx1[2,]\n\n\n\napply(x1,1,min)\napply(x1,2,mean)\n\n\n\n\n\ndnorm(0,mean=0,sd=1)\npnorm(1.645,0,1)\nqnorm(c(0.025,0.50,0.975),0,1)\n\n\n\n\n\ndpois(5,lambda=7)\n\ndunif(0,min=-5,max=20)\n\n\ndbinom(10,20,0.3)\n\n\n\n\n\ndt(0,1)\n\n\n\n\n\ndgamma(5,10,2)\n\n\n\n\n\na <- rgamma(1000,10,2)\nmean(a)\n\n\nrnorm(1000,4,5)\n\n\n\n\n\nlibrary(help=coda)\n\n\n\n\n\n\n\n\n\n## USER-CONTRIBUTED PACKAGES\ninstall.packages(\"Hmisc\")    # need an internet connection\nlibrary(Hmisc)\nsummarize(FEV,by=Smoke,FUN=mean)\nsummarize(FEV,by=Smoke,FUN=sd)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## READING IN DATA\n\n\n\nlibrary(xlsReadWrite)\nlibrary(RODBC)\n\nFEVdata2 <- read.xls(\"H:\\\\RApp\\\\FEVdata.xls\",colNames=TRUE)\nFEVdata1 <- read.table(\"H:\\\\RApp\\\\FEVdata.txt\",header=T,sep=\"\\t\")\ndata3 <- read.table(\"http://anson.ucdavis.edu/~johnson/epi204/data.txt\",\n\t               col.names=c(\"survive\",\"iss\",\"iciss\",\"bp\",\"rts\",\"age\",\"score\"))\nattach(FEVdata1)\nattach(FEVdata2)\n\nFEVdata1\nFEVdata2\n\nsummary(FEVdata1)\nsummary(FEVdata2)\n\n\n# If the Excel file does not contain variable names in Row 1\nFEVdata4  <- read.xls(file=\"H:\\\\RApp\\\\FEVdatanonames.xls\",colNames=c(\"Age\",\"FEV\",\"Smoke\"))\n\n\n\n\nFEVdata1[1:10,]\n\n\n\n\n\n\n\n\n\n## GRAPHING\n\n\n# Figure C.1.  Scatterplot\nplot(Age,FEV)\nlines(lowess(Age[Smoke==1],FEV[Smoke==1]),lwd=2)\nlines(lowess(Age[Smoke==0],FEV[Smoke==0]),lty=2,lwd=2)\nlegend(\"bottomright\",c(\"S\",\"NS\"),lty=c(1,2))\n\n\n\n\n\n# Figure C.2.  Gamma(5,2) pdf\nx <- seq(0.01,10,0.01)\nplot(x,dgamma(x,5,2),type=\"l\",ylab=\"f(x)\",main=\"Gamma(5,2)\")\n\n\n\n\n# Figure C.3.  Boxplot\ng=factor(Smoke,c(0,1),c(\"Non-smoker\",\"Smoker\"))\nboxplot(FEV~g,range=0,boxwex=0.25,ylab=\"FEV\",xlab=\"\")\nlines(rep(1.2,length(FEV[Smoke==0])),FEV[Smoke==0],type=\"p\")\nlines(rep(2.2,length(FEV[Smoke==1])),FEV[Smoke==1],type=\"p\")\n\n\n# Figure C.4.  Histogram\npar(mfrow=c(2,2))\n\nhist(FEV,main=\"\",ylim=c(0,100))   # Plot 1\n\nhist(FEV,main=\"\",prob=T,ylim=c(0,0.6))  \nlines(density(FEV),type='l')      # Plot 2\n                                \nplot(density(FEV[Smoke==0]),type='l',xlab=\"FEV\",\n     ylab=\"Density\", main=\"All Ages\",xlim=c(1,7),ylim=c(0,0.7))\nlines(density(FEV[Smoke==1]),lty=2)\nlegend(\"topright\", c(\"NS\",\"S\"),lty=c(1,2))   # Plot 3\n\nplot(density(FEV[Smoke==0 & Age>=14]),type='l',xlab=\"FEV\",\n     ylab=\"Density\", main=\"Age 14 and Older\",xlim=c(1,7),ylim=c(0,0.7))\nlines(density(FEV[Smoke==1 & Age>=14]),lty=2)\nlegend(\"topright\", c(\"NS\",\"S\"),lty=c(1,2))   # Plot 4\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## R/WinBUGS INTERFACE\n\n library(R2WinBUGS)\n n1 <- 17\n n2 <- 16\n y <- c(65,156,100,134,16,108,121,4,39,143,56,26,22,1,1,5,65)\n x <- c(56,65,17,7,16,22,3,4,2,3,8,4,3,30,4,43)\n leukemiadata <- list(\"n1\",\"n2\",\"y\",\"x\")\n parameters <- c(\"theta1\",\"theta2\",\"median1\",\"median2\")\n inits <- list(list(theta1=1, theta2=1))\n leuk.fit <- bugs(leukemiadata, inits, parameters,\"leukemia.txt\",\n       working.directory=\"H:\\\\RApp\", n.chains=1, n.iter=50000, \n       n.thin=1, n.burnin=0)\n print(leuk.fit)\n attach.bugs(leuk.fit)\n\n\n\n# Figure C.5.  Posterior densities of median time to death\nplot(density(median1), type=\"l\", xlab=\"\", main=\"\", ylab=\"\", xlim=c(0,75), ylim=c(0,0.15), lwd=3)\nlines(density(median2),lty=2,lwd=3)\nmtext(\"Median survival\",line=3,side=1,cex=1.5)\nmtext(\"Posterior density\",line=2.5,side=2,cex=1.5)\ntext(26,0.14,\"AG Negative\",lwd=2,cex=1.5)\ntext(61,0.03,\"AG Positive\",lwd=2,cex=1.5)\n\n\n\n# Figure C.6.  Plot 20 S1(t) curves\npar(mfrow=c(1,2))\n\ntime <- seq(0,170,1)\nplot(time,exp(-theta1[1]*time), type=\"l\", xlab=\"t\", ylab=\"\", cex=2, lwd=2)\nmtext(expression(S[1](~t)),line=2.5,side=2)\nfor(i in 2:20){\n\tlines(time, exp(-theta1[i]*time), lty=1, cex=2, lwd=2)\n}\n\n\n# Survival curves estimated by posterior means\n time <- seq(0,170,1)\n survcurves1 <- exp(-theta1%*%t(time))\n survmean1 <- apply(survcurves1,2,mean)\n survcurves2 <- exp(-theta2%*%t(time))\n survmean2 <- apply(survcurves2,2,mean)\n plot(time,survmean1,type=\"l\", xlab=\"t\", ylab=\"S(t)\",lwd=3)\n lines(time, survmean2,lty=2, lwd=3)\n legend(\"topright\", c(\"AG Positive\",\"AG Negative\"),lty=1:2,lwd=2)\n\n\n\n\n\n# Figure C.7.  Bands\n surv1 <- apply(survcurves1,2,quantile,c(0.025,0.50,0.975))\n surv2 <- apply(survcurves2,2,quantile,c(0.025,0.50,0.975))\n plot( time, surv1[2,], type=\"l\", xlab=\"t\", ylab=\"S(t)\", lwd=3)\n lines(time, surv1[1,], lty=1, lwd=3)\n lines(time, surv1[3,], lty=1, lwd=3)\n lines(time, surv2[2,], lty=2, lwd=3)\n lines(time, surv2[1,], lty=2, lwd=3)\n lines(time, surv2[3,], lty=2, lwd=3)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## WRITING NEW R FUNCTIONS\t\n\n\n\nt.interval=function(y1,y2,conflevel){\n  y1c=na.omit(y1)\n  y2c=na.omit(y2)\n  n1=length(y1c)\n  n2=length(y2c)\n  sp2=((n1-1)*var(y1c) + (n2-1)*var(y2c))/(n1+n2-2)\n  d=mean(y1c)-mean(y2c)\n  t=qt(conflevel+0.5*(1-conflevel),n1+n2-2)\n  l=d-t*sqrt(sp2*(1/n1+1/n2))\n  u=d+t*sqrt(sp2*(1/n1+1/n2))\n  return(c(l,d,u))\n}\n\n\n\nx <- rnorm(10)\ny <- rnorm(15,2,1)\n\nt.interval(x,y,0.95)\nt.test(x,y, var.equal=TRUE)\n\n\n\n\n\nx <- c(rnorm(100),NA,NA)\ny <- rnorm(15,2,1)\n\nt.interval(x,y,0.95)\nt.test(x,y, var.equal=TRUE)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "encoding": "ascii"}